<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="color-scheme" content="dark light">
    <title data-default="BLE-RC">BLE-RC</title>
    <style>
    @font-face {
        font-family: icon-pack;
        src: url(data:application/x-font-ttf;charset=utf-8;base64,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);
        font-weight: normal;
        font-style: normal;
    }
    [class^="icon-"]:before, [class*=" icon-"]:before {
        font-family: icon-pack;
        font-style: normal;
        font-weight: normal;
        speak: never;

        display: inline-block;
        text-decoration: inherit;
        width: 1em;
        margin-right: .2em;
        text-align: center;
        /* opacity: .8; */

        /* For safety - reset parent styles, that can break glyph codes*/
        font-variant: normal;
        text-transform: none;

        /* fix buttons height, for twitter bootstrap */
        line-height: 1em;

        /* Animation center compensation - margins should be symmetric */
        /* remove if not needed */
        margin-left: .2em;

        /* you can be more comfortable with increased icons size */
        /* font-size: 120%; */

        /* Font smoothing. That was taken from TWBS */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;

        /* Uncomment for 3D effect */
        /* text-shadow: 1px 1px 1px rgba(127, 127, 127, 0.3); */
    }

    .icon-filter:before { content: '\e800'; } /* '' */
    .icon-power:before { content: '\e801'; } /* '' */
    .icon-back:before { content: '\e802'; } /* '' */
    .icon-home:before { content: '\e803'; } /* '' */
    .icon-menu:before { content: '\e804'; } /* '' */
    .icon-plus:before { content: '\e805'; } /* '' */
    .icon-minus:before { content: '\e806'; } /* '' */
    .icon-down:before { content: '\e807'; } /* '' */
    .icon-left:before { content: '\e808'; } /* '' */
    .icon-right:before { content: '\e809'; } /* '' */
    .icon-up:before { content: '\e80a'; } /* '' */
    .icon-mute:before { content: '\e80b'; } /* '' */
    .icon-swap:before { content: '\e80c'; } /* '' */
    .icon-skip-back:before { content: '\e80d'; } /* '' */
    .icon-rew:before { content: '\e80e'; } /* '' */
    .icon-ffwd:before { content: '\e80f'; } /* '' */
    .icon-skip-next:before { content: '\e810'; } /* '' */
    .icon-record:before { content: '\e811'; } /* '' */
    .icon-stop:before { content: '\e812'; } /* '' */
    .icon-play-pause:before { content: '\e813'; } /* '' */
    .icon-circle:before { content: '\e814'; } /* '' */
    .icon-red:before { content: '\e814'; } /* '' */
    .icon-green:before { content: '\e814'; } /* '' */
    .icon-yellow:before { content: '\e814'; } /* '' */
    .icon-blue:before { content: '\e814'; } /* '' */
    .icon-guide:before { content: '\e815'; } /* '' */
    .icon-info:before { content: '\e816'; } /* '' */
    .icon-tv:before { content: '\e817'; } /* '' */
    .icon-keyboard:before { content: '\e818'; } /* '' */
    .icon-mouse:before { content: '\e819'; } /* '' */
    .icon-play:before { content: '\e81a'; } /* '' */
    .icon-pause:before { content: '\e81b'; } /* '' */
    .icon-update:before { content: '\e81c'; } /* '' */
    .icon-learn:before { content: '\e81d'; } /* '' */
    .icon-cog:before { content: '\e81e'; } /* '' */
    .icon-restart:before { content: '\e81f'; } /* '' */
    .icon-remote:before { content: '\e820'; } /* '' */
    .icon-dialpad:before { content: '\e821'; } /* '' */
    :root {
        --hue-bg: 225;
        --sat-bg: 14%;
        --lit-bg: 20%;
        --hue-fg: 0;
        --sat-fg: 0%;
        --lit-fg: 80%;
        --clr-bg: hsl(var(--hue-bg), var(--sat-bg), var(--lit-bg));
        --clr-fg: hsl(var(--hue-fg), var(--sat-fg), var(--lit-fg));
        --clr-mousepad-bg: hsl(var(--hue-bg), var(--sat-bg), calc(var(--lit-bg) + 5%));
        --clr-btn-bg: hsl(var(--hue-bg), var(--sat-bg), calc(var(--lit-bg) + 10%));
        --clr-btn-border: hsl(var(--hue-bg), var(--sat-bg), calc(var(--lit-bg) + 50%));
        --clr-alert: red;
        --gap: 1rem;
        --gap-small: calc(var(--gap) / 2);
        --gap-big: calc(var(--gap) + var(--gap) / 4);
        --gap-minimal: calc(var(--gap) / 4);
        --font-size: 16px;
        --line-height: 1.2;
        --menu-width: calc(min(75vw, 20rem) - 2 * var(--gap));
        --nav-height: calc((2rem * var(--line-height)) + 2 * var(--gap-small));
        --nav-shadow-width: 200px;
        --nav-shadow: 0 0 var(--nav-shadow-width) hsla(0 0% 0% / .5);
        --dpad-gap: 1em;
        --dpad-ok-width: 40%;
        --clr-dpad-gap: var(--clr-bg);
        --bs-remote-btn: 
            inset hsla(var(--hue-bg) var(--sat-bg) 15% / 1) 0 0px 0px 4px,
            inset hsla(var(--hue-bg) var(--sat-bg) 15% / .8) 0 -1px 5px 4px,
            inset hsla(var(--hue-bg) var(--sat-bg)  0% / .25) 0 -1px 0px 7px,
            inset hsla(var(--hue-bg) var(--sat-bg) 32% / .7) 0 2px 1px 7px,
            hsla(var(--hue-bg) var(--sat-bg) 0% / .15) 0 -5px 6px 4px,
            hsla(var(--hue-bg) var(--sat-bg) 30% / .3) 0 5px 6px 4px;
        --bs-directions-btn: 
            inset hsla(var(--hue-bg) var(--sat-bg) 15% / 1) 0 0px 0px 4px,
            inset hsla(var(--hue-bg) var(--sat-bg) 15% / .3) 0 -1px 5px 4px,
            inset hsla(var(--hue-bg) var(--sat-bg)  0% / .15) 0 -1px 0px 7px,
            inset hsla(var(--hue-bg) var(--sat-bg) 32% / .4) 0 2px 1px 7px,
            hsla(var(--hue-bg) var(--sat-bg) 0% / .15) 0 -5px 6px 4px,
            hsla(var(--hue-bg) var(--sat-bg) 30% / .3) 0 5px 6px 4px;
        --bs-mousepad: 
            hsla(var(--hue-bg) var(--sat-bg) 0% / .15) 0 -5px 6px 4px,
            hsla(var(--hue-bg) var(--sat-bg) 30% / .3) 0 5px 6px 4px;
        --ts-remote-btn: none;
        --brush-metal-dark: 
            repeating-linear-gradient(0deg,
                hsla(0,0%,50%,0) 0%,
                hsla(0,0%,50%,0) 3%,
                hsla(0,0%,50%,.02) 4.5%),
            repeating-linear-gradient(0deg, 
                hsla(0,0%,0%,0) 0%,
                hsla(0,0%,0%,0) 2%,
                hsla(0,0%,0%,.01) 2.5%),
            repeating-linear-gradient(0deg,
                hsla(0,0%,50%,0) 0%,
                hsla(0,0%,50%,0) 0.6%,
                hsla(0,0%,50%,.03) 1.2%),
            repeating-linear-gradient(0deg, 
                hsla(0,0%,0%,0) 0%,
                hsla(0,0%,0%,0) 2%,
                hsla(0,0%,0%,.02) 2.5%),
            repeating-linear-gradient(0deg, 
                hsla(0,0%,0%,0) 0%,
                hsla(0,0%,0%,0) 2%,
                hsla(0,0%,0%,.01) 2.5%);
        --gradient-btn:
            linear-gradient(
                to bottom,
                hsl(var(--hue-bg) var(--sat-bg) 35%) 0%,
                hsl(var(--hue-bg) var(--sat-bg) 15%) 46%,
                hsl(var(--hue-bg) var(--sat-bg) 10%) 50%,
                hsl(var(--hue-bg) var(--sat-bg) 14%) 53%,
                hsl(var(--hue-bg) var(--sat-bg) 5%) 76%,
                hsl(var(--hue-bg) var(--sat-bg) 14%) 87%,
                hsl(var(--hue-bg) var(--sat-bg) 7%) 100%);
        --bg-remote-btn: 
            var(--brush-metal-dark),
            var(--gradient-btn);
        --bg-remote-dpad-btn:
            var(--brush-metal-dark),
            linear-gradient(
                135deg,
                hsl(var(--hue-bg) var(--sat-bg) 35%) 0%,
                hsl(var(--hue-bg) var(--sat-bg) 15%) 46%,
                hsl(var(--hue-bg) var(--sat-bg) 10%) 50%,
                hsl(var(--hue-bg) var(--sat-bg) 14%) 53%,
                hsl(var(--hue-bg) var(--sat-bg) 5%) 76%,
                hsl(var(--hue-bg) var(--sat-bg) 14%) 87%,
                hsl(var(--hue-bg) var(--sat-bg) 7%) 100%);
        --bg-black-metal: 
            var(--brush-metal-dark),
            linear-gradient(80deg,
                var(--clr-bg) 0%,
                hsl(var(--hue-bg) var(--sat-bg) 4%) 40%,
                hsl(var(--hue-bg) var(--sat-bg) 12%) 55%,
                hsl(var(--hue-bg) var(--sat-bg) 12%) 65%,
                hsl(var(--hue-bg) var(--sat-bg) 4%) 75%,
                var(--clr-bg) 100%);
        --bg-dark-metal: 
            var(--brush-metal-dark),
            linear-gradient(80deg,
                var(--clr-bg) 0%,
                hsl(var(--hue-bg) var(--sat-bg) 8%) 40%,
                hsl(var(--hue-bg) var(--sat-bg) 9%) 55%,
                hsl(var(--hue-bg) var(--sat-bg) 9%) 65%,
                hsl(var(--hue-bg) var(--sat-bg) 8%) 75%,
                var(--clr-bg) 100%);
        font-size: var(--font-size);
        line-height: var(--line-height);
        --accent-color: dodgerblue;
        accent-color: var(--accent-color);
    }
    * {
        box-sizing: border-box;
        padding: 0;
        margin: 0;
        font-family: sans-serif;
    }
    :not(input):not(select):not(textarea) {
        user-select: none;
    }
    ::selection {
        background-color: var(--accent-color);
        color: white;
    }
    body {
        background-image: var(--bg-black-metal);
        background-size: 100vw 200vh;
        color: var(--clr-fg);
        overflow-x: hidden;
        width: 100vw;
        min-height: 100vh;
    }
    .nav-shadow {
        position: absolute;
        inset: 0 0 auto 0;
        height: var(--nav-height);
        box-shadow: var(--nav-shadow);
    }
    nav {
        background: var(--bg-dark-metal);
        padding: var(--gap-small);
        color: var(--clr-fg);
    }
    nav:not(.menu) {
        display: flex;
        align-items: center;
        gap: var(--gap-small);
        font-size: 2em;
        margin-bottom: var(--gap);
        position: sticky;
        inset: 0 0 auto;
        z-index: 1;
        overflow: hidden;
    }
    nav a, nav span {
        display: inline-block;
        color: inherit;
        text-decoration: none;
        font-family: icon-pack, sans-serif;
    }
    nav:not(.menu) a,
    nav:not(.menu) span {
        opacity: .5;
    }
    nav:not(.menu) a:last-of-type {
        margin-left: auto;
    }
    nav .room {
        font-size: 1.5rem;
    }
    .sending nav:not(.menu):before,
    .sending nav:not(.menu):after {
        content: "";
        position: absolute;
        inset: 0;
        margin: auto;
        border-radius: 50%;
        border: 10px solid hsla(0 0% 50% / .5);
        animation-name: nav-ripple;
        animation-duration: 2s;
        animation-iteration-count: infinite;
        animation-timing-function: cubic-bezier(0,.72,.62,.95);
        transform: scale(0);
    }
    .sending nav:not(.menu):after {
        animation-delay: 0.5s;
    }
    @keyframes nav-ripple {
        from {
            opacity: 1;
            transform: scale(0);
        }
        to {
            opacity: 0;
            transform: scale(1.5);
        }
    }
    nav.menu {
        position: fixed;
        font-size: 1.25em;
        width: var(--menu-width);
        inset: var(--nav-height) 0 0 auto;
        transition: transform 250ms ease-out; 
        transform: translateX(calc(var(--menu-width) + var(--nav-shadow-width) + 2 * var(--gap-small)));
        box-shadow: var(--nav-shadow);
        display: flex;
        flex-direction: column;
        z-index: 1;
    }
    nav.menu[data-open="true"] {
        transform: translateX(0);
    }
    nav.menu a {
        display: block;
        text-align: right;
        padding: var(--gap) var(--gap) 0;
    }
    nav.menu a[data-bottom="true"] {
        margin-top: auto;
    }
    button {
        background: var(--bg-remote-btn);
        box-shadow: var(--bs-remote-btn);
        text-shadow: var(--ts-remote-btn);
        border: 1px solid var(--clr-btn-border);
        color: var(--clr-fg);
    }
    button:active {
        --lit-bg: 10%;
    }
    .ws-off button {
        opacity: .5;
        pointer-event: none;
    }
    .buttons {
        display: inline-grid;
        gap: var(--gap-small);
        place-items: center;
    }
    button[data-code] {
        aspect-ratio: 1;
        font-size: 2em;
        height: 1.4em;
        border: none;
        border-radius: .2em;
        position: relative;
        touch-action: none;
        font-family: icon-pack, sans-serif;
        position: relative;
    }
    .col-3 {
        grid-template-columns: repeat(3, 1fr);
    }
    .col-4 {
        grid-template-columns: repeat(4, 1fr);
    }
    .col-5 {
        grid-template-columns: repeat(5, 1fr);
        padding-block: var(--gap);
    }
    .dpad .buttons button:nth-child(5),
    .buttons.numbers button,
    .buttons.custom button {
        font-size: 1.2rem;
        width: 2.8rem;
        aspect-ratio: 1;
        height: auto;
    }
    .p-block {
        padding-block: var(--gap);
    }
    .p-inline {
        padding-inline: var(--gap);
    }
    main {
        display: grid;
        gap: var(--gap);
    }
    section.remote {
        display: grid;
        grid-template-columns: 1fr;
        place-items: center;
        gap: var(--gap);
        position: relative;
        z-index: 0;
    }
    section.remote:before {
        position: absolute;
        inset-block: calc(-1 * var(--gap));
        width: 19em;
        background: var(--bg-remote-btn);
        z-index: 0;
        border-radius: 1em;
    }
    section.remote > * {
        z-index: 1;
    }
    section.keyboard {
        display: grid;
        gap: var(--gap-minimal);
        width: 100%;
    }
    main:not([data-page="learn"]):not([data-page="remap"]) section.keyboard {
        position: fixed;
        bottom: var(--gap-minimal);
    }
    section.mouse {
        width: min(40rem, calc(100vw - 2 * var(--gap)));
        position: fixed;
        inset: auto var(--gap) var(--gap);
        margin-inline: auto;
        display: grid;
        grid-template-areas: 
            "wheel wheel wheel"
            "mouse mouse mouse"
            "left middle right";
        grid-template-columns: 1.25fr .5fr 1.25fr;
        grid-template-rows: min-content 3fr 1fr;
    }
    section.mouse .wheel {
        grid-area: wheel;
        justify-self: center;
        width: min-content;
        display: grid;
        grid-template-rows: min-content 2rem 2rem min-content;
        grid-template-areas:
            ". icon-up ."
            "icon-left up icon-right"
            "icon-left down icon-right"
            ". icon-down .";
        align-items: center;
        touch-action: none;
        background: var(--clr-bg);
    }
    section.mouse .wheel span {
        display: block;
        margin-inline: auto;
    }
    section.mouse .wheel div {
        grid-area: up;
        cursor: pointer;
        width: 100%;
        height: 100%;
        border-radius: .5em .5em 0 0;
        background-image: 
            linear-gradient(to bottom,
                hsl(var(--hue-bg) var(--sat-bg) 7%) 0%,
                hsl(var(--hue-bg) var(--sat-bg) 30%) 80%,
                hsl(var(--hue-bg) var(--sat-bg) 50%) 100%);
    }
    section.mouse .wheel div:last-of-type {
        grid-area: down;
        border-radius: 0 0 .5em .5em;
        background-image: 
            linear-gradient(to top,
                hsl(var(--hue-bg) var(--sat-bg) 7%) 0%,
                hsl(var(--hue-bg) var(--sat-bg) 30%) 80%,
                hsl(var(--hue-bg) var(--sat-bg) 50%) 100%);
    }
    section.mouse .icon-up {
        grid-area: icon-up;
    }
    section.mouse .icon-down {
        grid-area: icon-down;
    }
    section.mouse .icon-left {
        grid-area: icon-left;
    }
    section.mouse .icon-right {
        grid-area: icon-right;
    }
    section.mouse .pad {
        width: 100%;
        aspect-ratio: 4 / 3;
        background: var(--clr-mousepad-bg);
        margin-inline: auto;
        border-top-left-radius: .75rem;
        border-top-right-radius: .75rem;
        border: 2px inset var(--clr-btn-bg);
        box-shadow: var(--bs-mousepad);
        grid-area: mouse;
        touch-action: none; /* improves mouse action @see https://stackoverflow.com/questions/16348031/disable-scrolling-when-touch-moving-certain-element */ 
    }
    section.mouse .mouse-btn {
        background: var(--clr-mousepad-bg);
        border: 2px outset var(--clr-btn-bg);
        box-shadow: var(--bs-mousepad);
    }
    section.mouse .left {
        grid-area: left;
        border-bottom-left-radius: .75rem;
    }
    section.mouse .middle {
        grid-area: middle;
    }
    section.mouse .right {
        grid-area: right;
        border-bottom-right-radius: .75rem;
    }
    section.all-buttons {
        display: grid;
        gap: var(--gap);
    }
    section.all-buttons h1,
    section.all-buttons h2,
    section.all-buttons > div > div {
        padding-inline: var(--gap);
    }
    section.all-buttons > div {
        display: grid;
        grid-template-columns: 1fr;
    }
    section.all-buttons .sticky-filter {
        position: sticky;
        top: var(--nav-height);
        border: 1px solid var(--clr-btn-border);
        background: var(--clr-bg);
        display: flex;
        padding: 0;
        align-items: center;
        z-index: 1;
    }
    section.all-buttons .sticky-filter:focus-within {
        border-color: var(--accent-color);
    }
    section.all-buttons .sticky-filter input:focus-within {
        outline: none;
    }
    section.all-buttons h2 {
        position: sticky;
        top: calc(var(--nav-height) + 1.5em + 2px);
        background: var(--clr-bg);
        padding-block: .25em;
        z-index: 1;
    }
    section.all-buttons > div > div {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-block: .75em;
    }
    @media (max-width: 26rem) {
        section.all-buttons > div > div {
            font-size: .9em;
        }
    }
    section.all-buttons > div > div:nth-child(odd) {
        background-color: hsla(0 0% 100% / .07);
    }
    section.all-buttons button {
        font-size: 1em;
        padding: .75em;
        aspect-ratio: revert;
        height: revert;
    }
    section.config > form {
        display: grid;
        gap: var(--gap);
    }
    section.config fieldset {
        border-color: var(--accent-color);
        border-style: solid none none;
    }
    section.config legend {
        padding-inline: var(--gap-small);
    }
    section.config input {
        font-size: 1rem;
    }
    section.config input[type="text"],
    section.config input[type="number"] { 
        border-bottom: 1px solid var(--clr-btn-border);
    }
    section.config label {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
    }
    section.config input[type="checkbox"] {
        margin-block: var(--gap);
        display: block;
    }
    /* Router */
    main:not([data-page="remote"]):not([data-page="learn"]):not([data-page="remap"]) section.remote > div,
    main:not([data-page="keyboard"]):not([data-page="learn"]):not([data-page="remap"]) section.keyboard,
    main:not([data-page="mouse"]) section.mouse,
    main:not([data-page="learn"]) section.learn-config,
    main:not([data-page="config"]) section.config,
    main:not([data-page="all-buttons"]) section.all-buttons,
    main:not([data-page="ota"]) section.ota,
    main:not([data-page="remap"]) section.remap-config,
    main:not([data-page="remap"]) section.remap {
        display: none;
    }
    main[data-page="keyboard"] section.remote.remote > div:is(.dpad),
    main[data-page="keyboard"] section.remote.remote > div:is(.functional),
    main[data-page="mouse"] section.remote.remote > div:is(.functional) {
        display: grid;
    }
    /* /Router */

    /* DPAD */
    .dpad {
        display: grid;
        place-items: center;
        grid-template-areas: "volume dpad channels";
        grid-template-columns: 20% 60% 20%;
        width: 18rem;
        aspect-ratio: 14 / 10;
    }
    .dpad > div {
        grid-area: dpad;
    }
    .dpad .background, .dpad .directions, .dpad .buttons {
        width: 100%;
        aspect-ratio: 1;
    }
    .dpad .background {
        display: grid;
        grid-template-areas: "dpad-background";
        place-items: center;
        border-radius: 50%;
        overflow: hidden;
        box-shadow: var(--bs-remote-btn);
        text-shadow: var(--ts-remote-btn);
    }
    .dpad .background .directions {
        grid-area: dpad-background;
        display: grid;
        gap: var(--dpad-gap);
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(2, 1fr);
        transform: rotate(45deg);
        background-image: var(--bg-black-metal);
    }
    .dpad .dir, .dpad .ok {
        aspect-ratio: 1;
        background: var(--bg-remote-dpad-btn);
        box-shadow: var(--bs-remote-btn);
        text-shadow: var(--ts-remote-btn);
    }
    .dpad .dir {
        box-shadow: var(--bs-directions-btn);
    }
    .dpad .ok-outline {
        grid-area: dpad-background;
        width: calc(var(--dpad-ok-width) + var(--dpad-gap));
        border-radius: 50%;
        transform: rotate(0deg);
        aspect-ratio: 1;
        background: var(--bg-black-metal);
    }
    .dpad .ok {
        grid-area: dpad-background;
        width: var(--dpad-ok-width);
        border-radius: 50%;
        transform: rotate(0deg);
    }
    /** Buttons */
    .dpad .buttons {
        display: grid;
        grid-template-columns: 1fr calc(var(--dpad-ok-width) + 2 * var(--dpad-gap)) 1fr;
        grid-template-rows: 1fr calc(var(--dpad-ok-width) + 2 * var(--dpad-gap)) 1fr;
        gap: revert;
        transform: rotate(0deg);
    }
    .dpad button {
        border: none;
        color: var(--clr-fg);
        font-size: 1.6em;
        min-width: 1.3em;
        height: revert;
        aspect-ratio: revert;
    }
    .dpad .buttons button {
        background: none;
        box-shadow: none;
    }
    .dpad .volume {
        grid-area: volume;
    }
    .dpad .channels {
        grid-area: channels;
    }
    .dpad .volume, .dpad .channels {
        display: grid;
        grid-template-columns: 1fr;
        place-content: space-around;
        height: 100%;
        justify-self: stretch;
        padding: var(--gap-small);
    }
    .dpad .volume button, .dpad .channels button {
        width: 100%;
        aspect-ratio: 1;
        border-radius: 50%;
        background-color: var(--clr-btn-bg);
    }
    .dpad .volume span, .dpad .channels span {
        text-align: center;
    }
    /* /DPAD */
    .keyboard > div {
        display: flex;
        justify-content: center;
        gap: var(--gap-minimal);
        margin-bottom: var(--gap-minimal);
    }
    .keyboard button[data-code] {
        aspect-ratio: revert;
        padding-inline: .4em;
        flex-grow: .1;
        height: 1.6em;
    }
    .keyboard > div:last-child {
        justify-content: space-between;
    }
    .keyboard > div:last-child button:nth-child(2) {
        flex-grow: 1;
    }
    /* icons */
    button [class^="icon-"] {
        display: grid;
        place-items: center;
        position: absolute;
        inset: 0;
        color: var(--clr-fg);
        font-size: 1.5rem;
    }
    button span.icon-power {
        color: var(--clr-alert);
    }
    button span.icon-red {
        color: var(--clr-alert);
    }
    button span.icon-green {
        color: greenyellow;
    }
    button span.icon-yellow {
        color: yellow;
    }
    button span.icon-blue {
        color: blue;
    }
    .dpad .buttons button > span {
        position: static;
    }
    /* /icons */
    .learn-config {
        display: grid;
        gap: var(--gap-small);
    }
    .learn-config p,
    .remap-config p {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .learn-config button,
    .remap-config button {
        border: none;
        padding: .75rem 1.5rem;
        color: var(--clr-alert);
        font-size: 1.2em;
    }
    .remap-config .reset {
        display: none;
    }
    .remap-config .reset.show {
        display: revert;
    }
    .overlay {
        position: fixed;
        inset: 0;
        background: hsla(0 0% 0% / .8);
        place-items: center;
        display: none;
        z-index: 1;
        padding: var(--gap);
    }
    .overlay.active {
        display: grid;
    }
    .overlay > button {
        color: var(--clr-alert);
        position: absolute;
        inset: var(--gap-big) var(--gap-big) auto auto;
        border: none;
        font-size: 2em;
        padding: var(--gap-small);
    }
    .overlay p {
        text-align: center;
    }
    .overlay p > span {
        font-size: 2em;
    }
    .overlay.remap {
        overflow-y: scroll;
        padding-top: calc(6 * var(--gap));
        gap: var(--gap);
    }
    .overlay.remap .sticky-filter {
        top: calc(-1 * (6 * var(--gap)));
    }
    .overlay.remap .all-buttons h2 {
        top: calc(-1 * (6 * var(--gap)) + 1.5em + 2px);
    }

    /* Form */
    form {
        margin: var(--gap-small);
    }
    form > * {
        margin-bottom: var(--gap);
    }
    fieldset {
        padding: var(--gap-small);
        border-color: var(--clr-border);
    }
    form button[type="submit"] {
        background: var(--accent-color);
        color: var(--clr-fg);
        font-size: 1.5em;
        padding: .75rem 1.5rem;
        border: none;
        border-radius: .25rem;
        box-shadow: none;
    }
    form button[type="submit"]:disabled {
        opacity: .5;
    }
    input:not([type="checkbox"]) {
        font-size: 1.5em;
        width: 100%;
        padding: var(--gap-minimal);
        border: 1px solid var(--clr-border);
    }
    input[type="file"] {
        font-size: 1em;
    }
    input {
        accent-color: var(--accent-color);
        background-color: inherit;
        color: inherit;
    }
    label {
        padding-top: var(--gap-small);
        display: block;
    }
    form > p.cta {
        text-align: right;
    }
    form p.result, form p.reload {
        text-align: center;
    }
    form p.result[data-error="true"] {
        color: var(--clr-alert);
    }
    form progress {
        display: block;
        margin-inline: auto;
    }
    form progress[data-show="false"],
    form p.reload[data-show="false"] {
        display: none;
    }
    /* /Form */

    .toast {
        position: fixed;
        inset: auto 0 2rem;
        margin-inline: auto;
        color: white;
        border-radius: 1rem;
        padding: var(--gap-small) var(--gap);
        width: fit-content;
        opacity: 1;
        transition: opacity 500ms linear;
    }
    .toast.out {
        opacity: 0;
    }
    .toast[data-type="success"] {
        background-color: green;
    }
    .toast[data-type="error"] {
        background-color: red;
    }
    .toast[data-type="info"] {
        background-color: blue;
    }
    .toast[data-type="warning"] {
        background-color: darkgoldenrod;
    }

    @media (max-width: 30rem) {
        :root {
            --gap: .85rem;
        }
        .keyboard button[data-code] {
            padding-inline: .3em;
            font-size: 1.5em;
        }
    }
    </style>
    <link rel="icon" href="data:,">
</head>
<body class="ws-off">
    <div class="nav-shadow"></div>
    <nav>
        <a href="/remote">&#xe820;</a>
        <a href="/keyboard">&#xe818;</a>
        <a href="/mouse">&#xe819;</a>
        <span class="room"></span>
        <a href="/menu">&#xe804;</a>
    </nav>
    <main data-page="remote">
        <section class="learn-config p-inline">
            <h1>Learn IR</h1>
            <p>Delete the entire configuration <button name="clear">&times;</button></p>
            <p>Forget a single button <button name="forget">&times;</button></p>
            <p>Hit the button you want learn and press the button on your IR remote.</p>
        </section>
        <section class="remap-config p-inline">
            <h1>Map Remote Buttons</h1>
            <p>Hit the button you want to map, then choose a function from the list.</p>
            <p>Note: Remapped/reset buttons also have to be re-learned.</p>
            <p>Reset all mappings <button name="resetAll">&times;</button></p>
            <p>Reset a single button <button name="reset">&times;</button></p>
            <p class="reset">Now hit the button you want to reset.</p>
        </section>
        <section class="remote">
            <div class="dpad">
                <div class="volume">
                    <button>&#xe805;</button>
                    <span>Vol</span>
                    <button>&#xe806;</button>
                </div>
                <div class="background">
                    <div class="directions">
                        <div class="dir" data-dir="up"></div>
                        <div class="dir" data-dir="right"></div>
                        <div class="dir" data-dir="down"></div>
                        <div class="dir" data-dir="left"></div>
                    </div>
                    <div class="ok-outline"></div>
                    <div class="ok"></div>
                </div>
                <div class="buttons">
                    <span></span>
                    <button>&utrif;</button>
                    <span></span>
                    
                    <button>&ltrif;</button>
                    <button>OK</button>
                    <button>&rtrif;</button>
                    
                    <span></span>
                    <button>&dtrif;</button>
                    <span></span>
                </div>
                <div class="channels">
                    <button>&#xe805;</button>
                    <span>Ch</span>
                    <button>&#xe806;</button>
                </div>
            </div>
        </section>
        <section class="keyboard"></section>
        <section class="mouse">
            <div class="wheel">
                <span class="icon-up"></span>
                <div class="wheel-up"></div>
                <div class="wheel-down"></div>
                <span class="icon-down"></span>
                <span class="icon-left"></span>
                <span class="icon-right"></span>
            </div>
            <div class="pad"></div>
            <div class="mouse-btn left" data-button="1"></div>
            <div class="mouse-btn middle" data-button="4"></div>
            <div class="mouse-btn right" data-button="2"></div>
        </section>
        <section class="ota">
            <form action="/update" method="post" enctype='multipart/form-data'>
                <h1>Over The Air update</h1>
                <fieldset>
                    <legend>Choose File:</legend>
                    <input type="file">
                    <progress value="0" max="100" data-show="false"></progress>
                    <p class="result"></p>
                    <p class="reload" data-show="false">Reload in <span></span> seconds...</p>
                </fieldset>
                <p class="cta">
                    <button type="submit" disabled="disabled">Upload</button>
                </p>
            </form>
        </section>
        <section class="all-buttons">
            <h1>All Buttons</h1>
            <label class="sticky-filter">
                <input>
                <span class="icon-filter"></span>
            </label>
        </section>
        <section class="config">
            <form autocomplete="off">
                <h1>Config</h1>
                <fieldset>
                    <legend>General</legend>
                    <label>Room<input type="text" name="room"></label>
                </fieldset>
                <fieldset>
                    <legend>Keyboard</legend>
                    <label>
                        Layout
                        <select name="kb_layout" data-numeric="1">
                            <option value="0">QWERTZ</option>
                            <option value="1">QWERTY</option>
                        </select>
                    </label>
                </fieldset>
                <fieldset>
                    <legend>Home-Assistant API</legend>
                    <label>Enable (needs reboot)<input type="checkbox" name="ha_api_enable" value="1"></label>
                    <label>IP<input type="text" name="ha_ip"></label>
                    <label>Port<input type="number" name="ha_port"></label>
                    <label>Token<input type="password" placeholder="" name="ha_token"></label>
                    <label>
                        <span>Send assigned IR codes</span>
                        <input type="checkbox" name="ha_send_assigned" value="1">
                    </label>
                </fieldset>
                <fieldset>
                    <legend>Websocket Broadcasts</legend>
                    <label>Enable<input type="checkbox" name="ws_br_enable" value="1"></label>
                    <label>
                        <span>Send assigned IR codes</span>
                        <input type="checkbox" name="ws_br_send_assigned" value="1">
                    </label>
                </fieldset>
                <p class="cta">
                    <button type="submit">Save</button>
                </p>
            </form>
        </section>
    </main>
    <nav class="menu">
        <a href="/learn">Learn IR Codes</a>
        <a href="/remap">Map Remote Buttons</a>
        <a href="/all-buttons">All Buttons</a>
        <a href="/config" data-bottom="true">Configuration</a>
        <a href="/ota">OTA Update</a>
        <a href="/reboot">Reboot</a>
    </nav>
    <div class="overlay learn">
        <button class="cancelIr">&times;</button>
        <p class="buttons">
            <span>Now press the button on your remote to learn</span>
            <button data-code>&times;</button>
        </p>
    </div>
    <div class="overlay forget">
        <button class="cancelIr">&times;</button>
        <p><span>Now press the button on your remote to be forgotten.</span></p>
    </div>
    <div class="overlay remap">
        <button class="cancelIr">&times;</button>
        <p class="buttons">
            <span>Now choose the function you want to assign to</span>
            <button data-code>&times;</button>
        </p>
        <section class="all-buttons">
            <label class="sticky-filter">
                <input>
                <span class="icon-filter"></span>
            </label>
        </section>
    </div>
    <script>
        class PageHandler {
            /**
             * @param {PageController} pageController
             */
            constructor(pageController) {
                this.pageController = pageController;
            }
        }
        class WebsocketHandler extends PageHandler {

            constructor(pageController) {
                super(pageController);
                this._active = false;
                this._attempts = 0;
                this._timeout = 2000;
                this._canReconnect = true;
                this._sendingStateTimeout = undefined;
                this._requestId = -1;
                this._callbacks = {};
            }

            get active() {
                return this._active && this.ws.readyState === WebSocket.OPEN;
            }

            set active(v) {
                this._active = typeof v == "boolean" && v;
            }

            get requestId() {
                return ++this._requestId;
            }

            run() {
                this.url = `ws://${location.host}:[%WS_PORT%]/jsonrpc`;
                if (this.url.includes("WS_PORT")) {
                    /* we assume dev env */
                    this.url = `ws://192.168.178.218:81/jsonrpc`;
                    document.querySelector('title').dataset.default = "IDE BLE-RC";
                }
                this.initHandler()
                    .initWebsocket();
                return this;
            }

            initHandler() {
                this.openedHandler = this.handleOpen.bind(this);
                this.closedHandler = this.handleClose.bind(this);
                this.messageHandler = this.handleMessage.bind(this);
                this.timeoutHandler = this.handleTimeout.bind(this);
                return this;
            }

            initWebsocket() {
                this._attempts++;
                console.debug("[Websocket] connect attempt %d...", this._attempts);
                this.ws = new WebSocket(this.url);
                this.addListeners();
                return this;
            }

            addListeners() {
                this.ws.addEventListener("open", this.openedHandler);
                this.ws.addEventListener("error", this.closedHandler);
                this.ws.addEventListener("close", this.closedHandler);
                this.ws.addEventListener("message", this.messageHandler);
                return this;
            }

            removeListeners() {
                this.ws.removeEventListener("open", this.openedHandler);
                this.ws.removeEventListener("error", this.closedHandler);
                this.ws.removeEventListener("close", this.closedHandler);
                this.ws.removeEventListener("message", this.messageHandler);
                return this;
            }

            connect() {
                if (!this.ws || this.ws.readyState === WebSocket.CLOSED) {
                    this.initWebsocket();
                }
            }

            close() {
                this._canReconnect = false;
                this.ws.close();
            }

            handleOpen() {
                console.debug("[Websocket] open");
                this.active = true;
                this.pageController.active = true;
            }

            handleClose() {
                console.debug("[Websocket] closed");
                this.active = false;
                this.pageController.active = false;
                this.pageController.sending = false;
                this.removeListeners();
                delete this.ws;
                if (this._canReconnect) {
                    this.connect();
                }
            }

            handleMessage(result) {
                const data = JSON.parse(result.data);
                if (data.config) {
                    this.pageController.config.data = data.config;
                }
                if (data.remote?.mappings) {
                    this.pageController.remapButtons.applyMappings(data.remote.mappings)
                }
                if (data.jsonrpc === "2.0") {
                    console.debug("[Websocket] incoming message", data);
                    if (this.wsTimeout) {
                        clearTimeout(this.wsTimeout);
                        delete this.wsTimeout;
                    }
                    const success = data.result === "OK" || data.result?.result === "OK";
                    if (success) {
                        if (data.result.method && "function" === typeof this._callbacks[data.id]) {
                            this._callbacks[data.id](data.result);
                            delete this._callbacks[data.id];
                        }
                        this.active = true;
                        console.debug("[Websocket] OK");
                    }
                    if (data.result?.message) {
                        this.pageController.toast = {
                            type: success ? TOAST_TYPE.success : TOAST_TYPE.error,
                            message: data.result.message
                        };
                    }
                }
            };

            handleTimeout() {
                console.debug("[Websocket] closing after timeout of %dms", this._timeout);
                this.ws.close();
                delete this.wsTimeout;
                this.pageController.active = false;
                this.pageController.sending = false;
            }

            keydown(btn) {
                this.active = false;
                this.send({
                    method: "keydown",
                    params: btn.dataset
                });
                this.pageController.sending = true;
            }

            keyup(btn) {
                this.send({
                    method: "keyup",
                    params: btn.dataset
                });
                if (this._sendingStateTimeout) {
                    clearTimeout(this._sendingStateTimeout);
                    this._sendingStateTimeout = undefined;
                }
                this.pageController.sending = false;
            }

            mouseDown(btn) {
                this.send({
                    method: "mousedown", skipResponse: true,
                    params: {
                        button: parseInt(btn.dataset.button, 10)
                    }
                });
            }

            mouseUp(btn) {
                this.send({
                    method: "mouseup", skipResponse: true,
                    params: {
                        button: parseInt(btn.dataset.button, 10)
                    }
                });
            }

            mouseClick(btn) {
                this.send({
                    method: "mouseclick", skipResponse: true,
                    params: {
                        button: parseInt(btn.dataset.button, 10)
                    }
                });
            }

            mouseMove(x = 0, y = 0, wheel = 0, hWheel = 0) {
                this.send({
                    method: "mousemove", skipResponse: true,
                    params: {x, y, wheel, hWheel}
                });
            }

            learn(btn, cb) {
                this.send({
                    method: "learn",
                    params: btn.dataset
                }, cb);
            }

            remap(btns, cb) {
                this.send({
                    method: "remap",
                    params: btns
                }, cb);
            }

            resetMapping(btn, cb) {
                this.send({
                    method: "resetBtn",
                    params: {
                        default: btn.dataset.defaultMapping
                    }
                }, cb)
            }

            deleteMappings() {
                this.send({
                    method: "deleteMappings"
                }, () => setTimeout(() => location.reload(), 2000));
            }

            forget(cb) {
                this.send({ method: "forget" }, cb);
            }

            cancelIr(cb) {
                this.send({ method: "cancelIr" }, cb);
            }

            clear() {
                this.send({ method: "clear" });
            }

            reboot() {
                this.send({ method: "reboot" });
            }

            saveConfig(config, cb) {
                this.send({
                    method: "config",
                    params: {config}
                }, cb);
            }

            send(message, cb) {
                if (this.pageController.active) {
                    const id = this.requestId;
                    if ("function" === typeof cb) {
                        this._callbacks[id] = cb;
                    }
                    message.jsonrpc = "2.0";
                    message.id = id;
                    console.debug("[Websocket] send", message);
                    this.ws.send(JSON.stringify(message));
                    if ("undefined" === typeof message.skipResponse && "undefined" === typeof this.wsTimeout) {
                        this.wsTimeout = setTimeout(this.timeoutHandler, this._timeout);
                    }
                }
            }
        }

        class Mouse extends PageHandler {
            constructor(pageController, node) {
                super(pageController);
                this.node = node;
                this.mouseIsDown = false;
                this.throttletimeout = 20;
                this.wheelthrottletimeout = 50;
                this.throttle = false;
                this.padClickTimeout = 100;
                this.current = {
                    x:0,y:0
                };
                this.wheelCurrent = {
                    x:0,y:0
                };
                this.initElements().initListeners().addListeners();
            }
            initElements() {
                this.pad = this.node.querySelector('.pad');
                this.left = this.node.querySelector('.left');
                this.middle = this.node.querySelector('.middle');
                this.right = this.node.querySelector('.right');
                this.wheel = this.node.querySelector('.wheel');
                this.wheelUp = this.wheel.querySelector('.wheel-up');
                this.wheelIconLeft = this.wheel.querySelector('.icon-left');
                this.wheelIconRight = this.wheel.querySelector('.icon-right');
                return this;
            }
            initListeners() {
                this.padDownHandler = this.handlePadDown.bind(this);
                this.padUpHandler = this.handlePadUp.bind(this);
                this.padMoveHandler = this.handlePadMove.bind(this);
                this.padEnterHandler = this.handlePadEnter.bind(this);
                this.padLeaveHandler = this.handlePadLeave.bind(this);
                this.buttonDownHandler = e => this.pageController.ws.mouseDown(e.currentTarget);
                this.buttonUpHandler = e => this.pageController.ws.mouseUp(e.currentTarget);
                this.clickHandler = e => this.pageController.ws.mouseClick(e.currentTarget);
                this.wheelDownHandler = this.handleWheelDown.bind(this);
                this.wheelUpHandler = this.handleWheelUp.bind(this);
                this.wheelMoveHandler = this.handleWheelMove.bind(this);
                return this;
            }
            addListeners() {
                this.pad.addEventListener('pointerdown', this.padDownHandler);
                this.pad.addEventListener('pointerup', this.padUpHandler);
                this.pad.addEventListener('pointermove', this.padMoveHandler);
                this.pad.addEventListener('pointerenter', this.padEnterHandler);
                this.pad.addEventListener('pointerleave', this.padLeaveHandler);
                this.left.addEventListener('pointerdown', this.buttonDownHandler);
                this.middle.addEventListener('pointerdown', this.buttonDownHandler);
                this.right.addEventListener('pointerdown', this.buttonDownHandler);
                this.left.addEventListener('pointerup', this.buttonUpHandler);
                this.middle.addEventListener('pointerup', this.buttonUpHandler);
                this.right.addEventListener('pointerup', this.buttonUpHandler);
                /* this.left.addEventListener('pointerup', this.clickHandler);
                this.middle.addEventListener('pointerup', this.clickHandler);
                this.right.addEventListener('pointerup', this.clickHandler); */
                this.wheel.addEventListener('pointerdown', this.wheelDownHandler);
                this.wheel.addEventListener('pointerup', this.wheelUpHandler);
                this.wheel.addEventListener('pointermove', this.wheelMoveHandler);
                return this;
            }
            handlePadEnter(e) {
                if ("touch" === e.pointerType) {
                    this.current = {
                        x: e.layerX,
                        y: e.layerY
                    };
                }
            }
            handlePadLeave(e) {
                if ("mouse" === e.pointerType) {
                    this.mouseIsDown = false;
                }
            }
            handlePadDown(e) {
                if ("touch" === e.pointerType) {
                    if (this.padUpTimeout) {
                        clearTimeout(this.padUpTimeout);
                        this.padUpTimeout = undefined;
                    }
                    if (this.padDownTimeout) {
                        /* console.log("Touch down"); */
                        this.buttonDownHandler({currentTarget: this.left});
                        this.padDownTimeout = undefined;
                    }
                    this.padDownTimeout = setTimeout(() => {
                        if (this.padUpTimeout) {
                            /* console.log("Touch down"); */
                            this.buttonDownHandler({currentTarget: this.left});
                        }
                        this.padDownTimeout = undefined;
                    }, this.padClickTimeout);
                }
                if ("mouse" === e.pointerType) {
                    this.mouseIsDown = true;
                    this.current = {
                        x: e.layerX,
                        y: e.layerY
                    };
                    this.buttonDownHandler({currentTarget: this.left});
                }
            }
            handlePadUp(e) {
                if ("touch" === e.pointerType) {
                    this.padUpTimeout = setTimeout(() => {
                        /* console.log("Touch up"); */
                        this.buttonUpHandler({currentTarget: this.left});
                        this.padUpTimeout = undefined;
                    }, this.padClickTimeout);
                }
                if ("mouse" === e.pointerType) {
                    this.mouseIsDown = false;
                    this.buttonUpHandler({currentTarget: this.left});
                }
            }
            handlePadMove(e) {
                if ("mouse" === e.pointerType && !this.mouseIsDown) {
                    return;
                }
                if ("touch" === e.pointerType) {
                    this.touchDown = false;
                }
                const movementX = e.layerX - this.current.x;
                const movementY = e.layerY - this.current.y;
                if (!this.throttle) {
                    this.current = {
                        x: e.layerX,
                        y: e.layerY
                    };
                    this.pageController.ws.mouseMove(movementX, movementY);
                    this.throttle = true;
                    setTimeout(() => this.throttle = false, this.throttletimeout);
                }
            }
            handleWheelDown(e) {
                if (e.pointerType === 'mouse') {
                    return;
                }
                if (e.pointerType === 'touch') {
                    this.wheelCurrent.x = e.layerX;
                    this.wheelCurrent.y = e.layerY;
                }
            }
            handleWheelUp(e) {
                if (e.pointerType === 'mouse') {
                    this.pageController.ws.mouseMove(
                        0, 0, e.composedPath().includes(this.wheelUp) ? 1 : -1
                    );
                }
                if (e.pointerType === 'touch') {
                    this.wheelCurrent.x = 0;
                    this.wheelCurrent.y = 0;
                }
            }
            handleWheelMove(e) {
                if (e.pointerType === 'mouse') {
                    return;
                } else if (e.pointerType === 'touch') {
                    if (!this.throttle) {
                        let movementX = e.layerX - this.wheelCurrent.x;
                        let movementY = e.layerY - this.wheelCurrent.y;
                        let wheel = 0;
                        let hWheel = 0;
                        if (Math.abs(movementX) > Math.abs(movementY)) {
                            hWheel = movementX > 0 ? -1 : 1;
                        } else {
                            wheel = movementY > 0 ? -1 : 1;
                        }
                        this.pageController.ws.mouseMove(0, 0, wheel, hWheel);
                        this.throttle = true;
                        setTimeout(() => this.throttle = false, this.wheelthrottletimeout);
                    }
                }
            }
        }

        class ButtonsAbstract extends PageHandler {            

            constructor(pageController, parent) {
                super(pageController);
                this._container = null;
                this.parent = parent;
                this.initHandler();
                for (let i of this) {
                    this.render(this.buttons[i], i);
                }
            }

            initHandler() {
                this.keyDownHandler = this.pageController.handleKeydown.bind(this.pageController);
                this.keyUpHandler = this.pageController.handleKeyup.bind(this.pageController);
                return this;
            }

            render(config, part) {
                const container = this.container;
                container.classList.add("buttons", part);
                if (config.classes) {
                    config.classes.forEach((c) => container.classList.add(c));
                }
                config.buttons.forEach((b) => {
                    let btn;
                    if (b.type > 0) {
                        btn = container.appendChild(document.createElement("button"));
                        btn.dataset.code = Object.values(USBHIDType).find(t => t.typeId === parseInt(b.type, 10))?.buttons[b.key].name;
                        btn.dataset.type = Object.values(USBHIDType).find(t => t.typeId === parseInt(b.type, 10))?.typeName;
                        btn.dataset.defaultMapping = `${b.type}-${b.key}`;
                        btn.addEventListener("pointerdown", this.keyDownHandler);
                        btn.addEventListener("pointerup", this.keyUpHandler);
                    } else {
                        btn = container.appendChild(document.createElement("span"));
                    }
                    let label = b.label[0] === "." ? this.getFontIcon(b.label) : b.label;
                    btn.innerHTML = label;
                });
            }

            getFontIcon(def) {
                const className = def.replace(/^\./, "");
                return `<span class="icon-${className}"></span>`;
            }

            get container() {
                return this.parent.appendChild(document.createElement("div"));
            }

            get buttons() {
                return {};
            }

            [Symbol.iterator]() {
                let index = -1;
                let data = Object.keys(this.buttons);
                return {
                    next: () => ({ value: data[++index], done: !(index in data) })
                };
            }
        }

        class Upper extends ButtonsAbstract {
            get container() {
                return this.parent
                        .insertBefore(document.createElement('div'), document.querySelector('.dpad'));
            }
            get buttons() {
                return {
                    top: {"classes":["col-3"],"buttons":[{"key":0,"type":2,"label":".power"},{"key":-1,"type":0,"label":""},{"key":-1,"type":0,"label":""}]},
                    numbers: {"classes":["col-3"],"buttons":[{"key":26,"type":1,"label":"1"},{"key":27,"type":1,"label":"2"},{"key":28,"type":1,"label":"3"},{"key":29,"type":1,"label":"4"},{"key":30,"type":1,"label":"5"},{"key":31,"type":1,"label":"6"},{"key":32,"type":1,"label":"7"},{"key":33,"type":1,"label":"8"},{"key":34,"type":1,"label":"9"},{"key":-1,"type":0,"label":""},{"key":35,"type":1,"label":"0"},{"key":-1,"type":0,"label":""}]},
                    functional: {"classes":["col-3"],"buttons":[{"key":37,"type":1,"label":".back"},{"key":41,"type":2,"label":".home"},{"key":1,"type":2,"label":".menu"}]}
                }
            }
        }

        class Dpad extends ButtonsAbstract {
            render(config, part) {
                const container = document.querySelector(".dpad");
                const buttons = container.querySelectorAll('button, span');
                config.buttons.forEach((b, i) => {
                    if (buttons[i].tagName === "BUTTON") {
                        buttons[i].dataset.code = Object.values(USBHIDType).find(t => t.typeId === parseInt(b.type, 10))?.buttons[b.key].name;
                        buttons[i].dataset.type = Object.values(USBHIDType).find(t => t.typeId === parseInt(b.type, 10))?.typeName;
                        buttons[i].dataset.defaultMapping = `${b.type}-${b.key}`;
                        buttons[i].addEventListener("pointerdown", this.keyDownHandler);
                        buttons[i].addEventListener("pointerup", this.keyUpHandler);
                    }
                    let label = b.label[0] === "." ? this.getFontIcon(b.label) : b.label;
                    buttons[i].innerHTML = label;
                });
            }

            get buttons() {
                return {
                    dpad: {
                        "buttons":[
                            {"key":27,"type":2,"label":".plus"},
                            {"key":-1,"type":0,"label":"Vol"},
                            {"key":28,"type":2,"label":".minus"},                            
                            
                            {"key":-1,"type":0,"label":""},
                            {"key":77,"type":1,"label":".up"},
                            {"key":-1,"type":0,"label":""},

                            {"key":75,"type":1,"label":".left"},
                            {"key":36,"type":1,"label":"OK"},
                            {"key":74,"type":1,"label":".right"},

                            {"key":-1,"type":0,"label":""},
                            {"key":76,"type":1,"label":".down"},
                            {"key":-1,"type":0,"label":""},                            
                            
                            {"key":14,"type":2,"label":".plus"},
                            {"key":-1,"type":0,"label":"CH"},
                            {"key":15,"type":2,"label":".minus"}
                        ]
                    }
                }
            }
        }

        class Lower extends ButtonsAbstract {
            get buttons() {
                return {
                    functionalLower: {"classes":["col-3"],"buttons":[{"key":26,"type":2,"label":".mute"},{"key":0,"type":5,"label":".mouse"},{"key":7,"type":2,"label":".swap"}]},
                    media: {"classes":["col-4"],"buttons":[{"key":22,"type":2,"label":".skip-back"},{"key":20,"type":2,"label":".rew"},{"key":19,"type":2,"label":".ffwd"},{"key":21,"type":2,"label":".skip-next"},{"key":18,"type":2,"label":".record"},{"key":23,"type":2,"label":".stop"},{"key":25,"type":2,"label":".play-pause"}]},
                    colors: {"classes":["col-4"],"buttons":[{"key":3,"type":2,"label":".red"},{"key":4,"type":2,"label":".green"},{"key":6,"type":2,"label":".yellow"},{"key":5,"type":2,"label":".blue"}]},
                    custom: {"classes":["col-4", "custom"],"buttons":[{"key":53,"type":1,"label":"F1"},{"key":54,"type":1,"label":"F2"},{"key":55,"type":1,"label":"F3"},{"key":56,"type":1,"label":"F4"},{"key":57,"type":1,"label":"F5"},{"key":58,"type":1,"label":"F6"},{"key":59,"type":1,"label":"F7"},{"key":60,"type":1,"label":"F8"},{"key":61,"type":1,"label":"F9"},{"key":62,"type":1,"label":"F10"},{"key":63,"type":1,"label":"F11"},{"key":64,"type":1,"label":"F12"}]}
                }
            }
        }

        class Keyboard extends ButtonsAbstract {

            constructor(pageController, parent) {
                super(pageController, parent);

                this.withInput = false; /* currently not possible since e.code property is always empty */
                
                if (this.withInput) {
                    this.input = document.createElement('input');
                    this.input.addEventListener('keydown', e => {
                        e.preventDefault();
                        let keyCode = this.parseKey(e);
                        console.log(keyCode, e);
                        document.querySelector('nav .room').innerHTML = keyCode;
                        if (!e.repeat && keyCode) {
                            this.pageController.ws.keydown({
                                dataset: {
                                    code: keyCode,
                                    type: USBHIDType.keyboard.typeName
                                }
                            });
                        }
                    });
                    this.input.addEventListener('keyup', e => {
                        e.preventDefault();
                        let keyCode = this.parseKey(e);
                        console.log(keyCode, e);
                        if (keyCode) {
                            this.pageController.ws.keyup({
                                dataset: {
                                    code: keyCode,
                                    type: USBHIDType.keyboard.typeName
                                }
                            });
                        }
                    });

                    this.parent.appendChild(this.input);
                }
            }

            parseKey(e) {
                let keyCode;
                if (e.code.match(/^(Key|Digit)/)) {
                    keyCode = e.code.toUpperCase().replace(/(KEY|DIGIT)/, "KEYCODE_");
                } else if (KeyEventCodeMap.hasOwnProperty(e.code)) {
                    keyCode = KeyEventCodeMap[e.code];
                } else {
                    keyCode = false;
                }
                return keyCode;
            }

            get buttons() {
                /* layout QWERTZ */
                const buttons = {
                    rowN: {"buttons":[{"key":26,"type":1,"label":"1"},{"key":27,"type":1,"label":"2"},{"key":28,"type":1,"label":"3"},{"key":29,"type":1,"label":"4"},{"key":30,"type":1,"label":"5"},{"key":31,"type":1,"label":"6"},{"key":32,"type":1,"label":"7"},{"key":33,"type":1,"label":"8"},{"key":34,"type":1,"label":"9"},{"key":35,"type":1,"label":"0"}]},
                    row1: {"buttons":[{"key":16,"type":1,"label":"Q"},{"key":22,"type":1,"label":"W"},{"key":4,"type":1,"label":"E"},{"key":17,"type":1,"label":"R"},{"key":19,"type":1,"label":"T"},{"key":24,"type":1,"label":"Z"},{"key":20,"type":1,"label":"U"},{"key":8,"type":1,"label":"I"},{"key":14,"type":1,"label":"O"},{"key":15,"type":1,"label":"P"}]},
                    row2: {"buttons":[{"key":0,"type":1,"label":"A"},{"key":18,"type":1,"label":"S"},{"key":3,"type":1,"label":"D"},{"key":5,"type":1,"label":"F"},{"key":6,"type":1,"label":"G"},{"key":7,"type":1,"label":"H"},{"key":9,"type":1,"label":"J"},{"key":10,"type":1,"label":"K"},{"key":11,"type":1,"label":"L"}]},
                    row3: {"buttons":[{"key":-1,"type":0,"label":""},{"key":25,"type":1,"label":"Y"},{"key":23,"type":1,"label":"X"},{"key":2,"type":1,"label":"C"},{"key":21,"type":1,"label":"V"},{"key":1,"type":1,"label":"B"},{"key":13,"type":1,"label":"N"},{"key":12,"type":1,"label":"M"},{"key":38,"type":1,"label":"&#x232b"}]},
                    row4: {"buttons":[{"key":-1,"type":0,"label":"&nbsp;"},{"key":40,"type":1,"label":"&nbsp"},{"key":36,"type":1,"label":"&#x23ce"}]}
                };
                if (this.pageController.config.data.kb_layout === KB_QWERTY) {
                    buttons.row1.buttons[5].label = 'Y';
                    buttons.row3.buttons[1].label = 'Z';
                }
                return buttons;
            }

            destroy() {
                this.parent.querySelectorAll('button').forEach(b => {
                    b.removeEventListener('pointerdown', this.keyDownHandler);
                    b.removeEventListener('pointerUp', this.keyUpHandler);
                });
                this.parent.innerHTML = '';
            }
        }

        class Menu extends PageHandler {
            constructor(pageController) {
                super(pageController);
                this.pageController = pageController;
                this.node = document.querySelector('nav.menu');
            } 
            toggle() {
                this.open = !this.open;
            }
            get open() {
                return this.node.dataset.open === "true";
            }
            set open(s) {
                this.node.dataset.open = typeof s === "boolean" && s ? "true" : "false";
            }
        }

        class Nav extends PageHandler {
            constructor(pageController) {
                super(pageController);
                this.node = document.querySelector('nav:not(.menu)');
                this.btns = document.querySelectorAll("nav a");
                this.btns.forEach((b) => {
                    b.addEventListener("click", this.handlePointerEvent.bind(this));
                })
                window.addEventListener('popstate', this.handlePointerEvent.bind(this));
                history.replaceState({path: `/${this.pageController.main.dataset.page}`}, document.title);
            }

            handlePointerEvent(e) {
                e.preventDefault();
                let path;
                console.log(e);
                if (e.type === 'click') {
                    path = e.currentTarget.pathname;
                    if (this.pageController.menu.open) {
                        history.replaceState({path}, document.title);
                    } else {
                        history.pushState({path}, document.title);
                    }
                } else {
                    path = e.state?.path || `/${this.pageController.main.dataset.page}`;
                }
                path !== '/menu' && (this.pageController.menu.open = false);
                console.log(path, history.state);
                switch (path) {
                    case "/remote":
                    case "/keyboard":
                    case "/learn":
                    case "/all-buttons":
                    case "/ota":
                    case "/config":
                    case "/remap":
                        this.pageController.page = path.replace(/^\//, "");
                        break;
                    case "/mouse":
                        this.pageController.page = path.replace(/^\//, "");
                        this.pageController.ws.mouseMove(1, 1);
                        break;
                    case "/menu":
                        this.pageController.menu.toggle();
                        break;
                    case "/reboot":
                        if (confirm('Reboot?')) {
                            this.pageController.ws.reboot();
                        }
                        break;
                }
            }

            set room(r) {
                this.node.querySelector('.room').innerHTML = r;
            }
        }

        class Overlay extends PageHandler {
            constructor(pageController, node) {
                super(pageController);
                this.node = node;
                this.node.querySelector(".cancelIr")
                    .addEventListener("pointerup", () => {
                        this.pageController.ws.cancelIr(() => {this.show = false;});
                    });
            }
            set show(v) {
                this.node.classList.toggle("active", v);
            }

            set button(label) {
                const btn = this.node.querySelector("p button");
                if (btn) {
                    btn.innerHTML = label;
                }
            }

            get button() {
                const btn = this.node.querySelector("p button");
                if (btn) {
                    return btn;
                }
                return null;
            }
        }

        class Ota extends PageHandler {
            constructor(pageController) {
                super(PageController);
                this.initElements().initListeners().addListeners();
            }
            initElements() {
                this.node = document.querySelector('.ota form');
                this.inputFile = this.node.querySelector('input[type="file"]');
                this.trigger = this.node.querySelector('button[type="submit"]');
                this.progressBar = this.node.querySelector('progress');
                this.result = this.node.querySelector('p.result');
                this.reload = this.node.querySelector('p.reload');
                this.reloadCountdown = this.reload.querySelector('span');
                this.disabled = !this.hasFile;
                return this;
            }
            initListeners() {
                this.handleSubmit = this.submitHandler.bind(this);
                this.handleXhrReadyState = this.xhrReadyStateHandler.bind(this);
                this.handleXhrProgress = this.xhrProgressHandler.bind(this);
                return this;
            }
            addListeners() {
                this.inputFile.addEventListener('change', e => {
                    this.disabled = !this.hasFile;
                });
                this.node.addEventListener('submit', this.handleSubmit);
                return this;
            }
            submitHandler(e) {
                e.preventDefault();
                const file = this.inputFile.files[0];
                this.error = false;
                this.resultText = "";
                if (file.name.match(/.*\.bin/)) {
                    let data = new FormData();
                    data.append('file', file, file.name);
                    try {
                        this.initXhr();
                        this.xhr.send(data);
                        this.showProgress = true;
                    } catch (error) {
                        this.error = true;
                        this.resultText = error.toString();
                        this.showProgress = false;
                    }
                } else {
                    this.inputFile.value = "";
                }
            }
            initXhr() {
                this.xhr = new XMLHttpRequest();
                this.xhr.open('POST', '/ota', true);
                this.xhr.addEventListener('readystatechange', this.handleXhrReadyState);
                this.xhr.upload.addEventListener('progress', this.handleXhrProgress);
            }
            xhrReadyStateHandler() {
                if (this.xhr.readyState === XMLHttpRequest.DONE) {
                    if (this.xhr.status === 200) {
                        this.resultText = this.xhr.responseText;
                        this.startReload();
                    } else {
                        this.error = this.xhr.statusText;
                    }
                    this.xhr.removeEventListener('readystatechange', this.handleXhrReadyState);
                    this.xhr.upload.removeEventListener('progress', this.handleXhrProgress);
                    delete this.xhr;
                    this.showProgress = false;
                }
            }
            xhrProgressHandler(e) {
                if (e.lengthComputable) {
                    const p = Math.floor(100 * e.loaded / e.total);
                    this.progress = p;
                }
            }
            startReload() {
                this.showReload = true;
                let countdown = 20;
                this.reloadCountdown.innerHTML = countdown.toString();
                const interval = setInterval(() => {
                    countdown -= 1;
                    this.reloadCountdown.innerHTML = countdown.toString();
                    if (countdown <= 0) {
                        clearInterval(interval);
                        location.reload();
                    }
                }, 1000);
            }
            set disabled(v) {
                this.trigger.disabled = "boolean" == typeof v && v;
            }
            get hasFile() {
                return !!this.inputFile.value;
            }
            set showProgress(v) {
                this.progressBar.dataset.show = ("boolean" == typeof v && v).toString();
            }
            set showReload(v) {
                this.reload.dataset.show = ("boolean" == typeof v && v).toString();
            }
            set progress(v) {
                this.progressBar.value = parseInt(v, 10);
                this.progressBar.innerHTML = `${v}%`;
            }
            set resultText(t) {
                this.result.innerHTML = t;
            }
            set error(e) {
                if (e instanceof Error) {
                    this.resultText = e.toString();
                }
                if ("string" === typeof e) {
                    this.resultText = e;
                }
                this.result.dataset.error = "boolean" === typeof e ? e.toString() : true;
            }
        }

        class AllButtons extends ButtonsAbstract {

            get label() { return "Test"; }

            constructor(pageController, parent) {
                super(pageController, parent);
                this.search = this.parent.querySelector('input');
                this.initSearch();
            }
            render(config, part) {
                this.items = this.items || [];
                const container = document.createElement('div');
                const header = document.createElement('H2');
                header.innerHTML = config.label;
                this.parent.appendChild(header);
                this.parent.appendChild(container);
                config.buttons.forEach((b, i) => {
                    const wrapper = document.createElement('div');
                    wrapper.innerText = `${i} - ${b.name}`;
                    container.appendChild(wrapper);
                    const btn = document.createElement('button');
                    btn.dataset.code = Object.values(USBHIDType).find(t => t.typeId === parseInt(config.typeId, 10))?.buttons[i].name;
                    btn.dataset.type = Object.values(USBHIDType).find(t => t.typeId === parseInt(config.typeId, 10))?.typeName;
                    btn.addEventListener("pointerdown", this.keyDownHandler);
                    btn.addEventListener("pointerup", this.keyUpHandler);
                    btn.innerHTML = this.label;
                    wrapper.appendChild(btn);
                    this.items.push(wrapper);
                });
            }
            initSearch() {
                this.search.addEventListener('focus', () => this.search.select());
                this.search.addEventListener('keyup', this.handleSearch.bind(this));
            }
            handleSearch(e) {
                const term = e.currentTarget.value.toLowerCase();
                this.items.map(item => {
                    item.style.display = item.firstChild.textContent.toLowerCase()
                        .includes(term) ? '' : 'none';
                });
            }
            onshow() {
                this.search.focus();
                this.handleSearch({currentTarget: this.search})
            }
        }

        class RemapButtons extends AllButtons {

            get label() { return "Apply"; }

            constructor(pageController, parent) {
                super(pageController, parent);
                this.resetBtn = document.querySelector('section.remap-config button[name="reset"]');
                this.resetBtn.addEventListener('pointerup', this.toggleResetHandler);
                this.resetAllBtn = document.querySelector('section.remap-config button[name="resetAll"]');
                this.resetAllBtn.addEventListener('pointerup', this.resetAllHandler);
            }

            initHandler() {
                this.keyDownHandler = e => undefined;
                this.keyUpHandler = this.handleRemap.bind(this);
                this.toggleResetHandler = this.toggleReset.bind(this);
                this.resetAllHandler = this.resetAll.bind(this);
            }

            applyMappings(mappings) {
                Object.keys(mappings).forEach(m => {
                    if (mappings[m]) {
                        let typeId = parseInt(mappings[m].split("-").shift(), 10);
                        let codeId = parseInt(mappings[m].split("-").pop(), 10);
                        let codeNew = Object.values(USBHIDType).find(t => t.typeId === typeId)?.buttons[codeId].name;
                        let typeNew = Object.values(USBHIDType).find(t => t.typeId === typeId)?.typeName;
                        let btn = document.querySelector(`[data-default-mapping="${m}"]`);
                        btn.dataset.type = typeNew;
                        btn.dataset.code = codeNew;
                    }
                });
                this.pageController.remapOverlay.show = false;
            }

            handleRemap(e) {
                const newType = e.currentTarget.dataset.type;
                const newCode = e.currentTarget.dataset.code;
                const typeIdNew = Object.values(USBHIDType).find(t => t.typeName === newType)?.typeId;
                const codeIdNew = Object.values(USBHIDType).find(t => t.typeName === newType)?.buttons.findIndex(b => b.name === newCode);

                this.pageController.ws.remap({
                        old: this.pageController.remapOverlay.button.dataset.defaultMapping,
                        new: `${typeIdNew}-${codeIdNew}`
                    }
                );
            }

            handleReset(btn) {
                this.pageController.ws.resetMapping(btn, this.applyDefault.bind(this));
            }

            applyDefault(result) {
                this.resetMode = false;
                const btn = document.querySelector(`[data-default-mapping="${result.btn}"]`);
                const defaultTypeId = parseInt(result.btn.split('-').shift(), 10);
                const defaultCodeId = parseInt(result.btn.split('-').pop(), 10);
                btn.dataset.code = Object.values(USBHIDType).find(t => t.typeId === defaultTypeId)?.buttons[defaultCodeId].name;
                btn.dataset.type = Object.values(USBHIDType).find(t => t.typeId === defaultTypeId)?.typeName;
            }

            resetAll() {
                if (confirm("Delete Mappings?")) {
                    this.pageController.ws.deleteMappings();
                }
            }

            toggleReset() {
                this.resetMode = !this.resetMode;
            }

            set resetMode(v) {
                document.querySelector("section.remap-config p.reset").classList.toggle('show', "boolean" === typeof v && v);
            }

            get resetMode() {
                return document.querySelector("section.remap-config p.reset").classList.contains('show');
            }
        }

        class Config extends PageHandler {
            constructor(pageController, node) {
                super(pageController);
                this._data = {};
                this.node = node;
                this.initElements().addListeners();
            }

            initElements() {
                this.form = this.node.querySelector('form');
                return this;
            }

            addListeners() {
                this.form.addEventListener("submit", e => {
                    e.preventDefault();
                    this.pageController.ws.saveConfig(this.json, () => this.pageController.active = true);
                    this.pageController.active = false;
                });
                return this;
            }

            get json() {
                const object = {};
                (new FormData(this.form)).forEach((value, key) => {
                    let elem = this.form.elements[key];
                    if (value) {
                        switch (elem.type) {
                            case "number":
                                value = parseInt(value, 10);
                                break;
                            case "checkbox":
                                value = true;

                        }
                        if (elem.dataset.numeric) {
                            value = parseInt(value, 10);
                        }
                        if(!Reflect.has(object, key)){
                            object[key] = value;
                            return;
                        }
                        if(!Array.isArray(object[key])){
                            object[key] = [object[key]];    
                        }
                        object[key].push(value);
                    }
                });
                return object;
            }

            set data(d) {
                this._data = d;
                this.pageController.applyConfig();
                for (let [key, value] of Object.entries(this._data)) {
                    let elem = this.form.elements[key];
                    if (elem) {
                        if (elem.dataset.numeric) {
                            value = parseInt(value, 10);
                        }
                        switch (elem.type) {
                            case 'password':
                                elem.placeholder = "*****";
                                elem.value = "";
                                break;
                            case "checkbox":
                                elem.checked = typeof value === 'boolean' && value;
                                break;
                            default:
                                elem.value = value;
                        }
                    }
                }
            }

            get data() {
                return this._data || {};
            }
        }

        class PageController {
            run() {
                try {
                    return this.initMain()
                        .initWebsocket()
                        .initKeys()
                        .initPages()
                        .initBody()
                        .initForget()
                        .initClear()
                        .initVisibility();
                } catch (error) {
                    console.error(error);
                }
            }

            initMain() {
                this.main = document.querySelector("main");
                this.config = new Config(this, document.querySelector("section.config"));
                this.nav = new Nav(this);
                this.menu = new Menu(this);
                return this;
            }

            initWebsocket() {
                this.ws = new WebsocketHandler(this).run();
                return this;
            }

            initKeys() {
                this.upper = new Upper(this, document.querySelector("section.remote"));
                this.dpad = new Dpad(this, document.querySelector("section.remote"));
                this.lower = new Lower(this, document.querySelector("section.remote"));
                return this;
            }

            initKeyboard() {
                const section = document.querySelector("section.keyboard");
                if (this.keyboard) {
                    this.keyboard.destroy();
                }
                this.keyboard = new Keyboard(this, section);
                return this;
            }

            initPages() {
                this.ota = new Ota(this);
                this.mouse = new Mouse(this, document.querySelector("section.mouse"));
                this.allButtons = new AllButtons(this, document.querySelector("main > section.all-buttons"));
                this.remapButtons = new RemapButtons(this, document.querySelector(".overlay.remap section.all-buttons"));
                this.learnOverlay = new Overlay(this, document.querySelector(".overlay.learn"));
                this.forgetOverlay = new Overlay(this, document.querySelector(".overlay.forget"));
                this.remapOverlay = new Overlay(this, document.querySelector(".overlay.remap"));
                this.pages = {
                    'all-buttons': this.allButtons
                };
                return this;
            }

            initVisibility() {
                document.addEventListener("visibilitychange", () => {
                    console.debug("Visibility: is hidden %s", document.hidden);
                    if (document.hidden) {
                        this.ws.close();
                    } else {
                        this.ws.connect();
                    }
                }, false);
                return this;
            }

            initBody() {
                document.body.addEventListener('pointerup', (e) => {
                    const p = e.composedPath();
                    if (p.indexOf(this.menu.node) < 0 && p.indexOf(this.nav.node) < 0) {
                        this.menu.open = false;
                    }
                });
                return this;
            }

            invokeLearn(btn) {
                this.learnOverlay.button = btn.innerHTML;
                this.ws.learn(btn, () => {this.learnOverlay.show = false;});
                this.learnOverlay.show = true;
            }

            invokeRemap(btn) {
                if (this.remapButtons.resetMode) {
                    this.remapButtons.handleReset(btn);
                } else {
                    this.remapOverlay.button = btn.innerHTML;
                    this.remapOverlay.button.dataset.defaultMapping = btn.dataset.defaultMapping;
                    this.remapOverlay.show = true;
                }
            }

            initForget() {
                document.querySelector('button[name="forget"]')
                .addEventListener("pointerup", (e) => {
                    this.ws.forget(() => {this.forgetOverlay.show = false;});
                    this.forgetOverlay.show = true;
                });
                return this;
            }

            initClear() {
                document.querySelector('button[name="clear"]')
                .addEventListener("pointerup", (e) => {
                    if (confirm("Delete Configuration?")) {
                        this.ws.clear();
                    }
                });
                return this;
            }

            handleKeydown(e) {
                if (['learn', 'remap'].includes(this.page) || !this.ws.active) return;
                this.ws.keydown(e.currentTarget)
            }

            handleKeyup (e) {
                if (this.page === "learn") {
                    this.invokeLearn(e.currentTarget)
                } else if (this.page === "remap") {
                    this.invokeRemap(e.currentTarget);
                } else {
                    this.ws.keyup(e.currentTarget)
                }
            }

            applyConfig() {
                this.initKeyboard();
                this.nav.room = this.config.data.room || '';
                const title = document.querySelector('title').dataset.default;
                document.querySelector('title').innerHTML =
                    this.config.data.room
                    ? `${this.config.data.room} - ${title}`
                    : title;
            }

            set toast(m) {
                const toast = document.createElement('div');
                toast.classList.add("toast");
                toast.dataset.type = m.type
                toast.innerHTML = m.message;
                toast.addEventListener("transitionend", e => {
                    document.body.removeChild(toast);
                }, {once: true});
                document.body.appendChild(toast);
                setTimeout(() => toast.classList.add("out"), 2000);
            }

            get page() {
                return this.main.dataset.page;
            }
            set page(page) {
                this.main.dataset.page = page;
                if (typeof this.pages[page]?.onshow === 'function') {
                    this.pages[page].onshow();
                }
                window.scrollTo(0,0);
            }

            get active() {
                return !document.body.classList.contains("ws-off");
            }

            set active(v) {
                document.body.classList.toggle("ws-off", !v);
            }

            set sending(v) {
                if (v) {
                    document.body.classList.add("sending");
                } else {
                    this.nav.node.addEventListener('animationiteration', () => {
                        document.body.classList.remove("sending");
                    }, {once: true});
                }
            }
        }

        const TOAST_TYPE = {
            error: "error",
            success: "success",
            warning: "warning",
            info: "info"
        }

        const HIDKeyboard = [
            {name: "KEYCODE_A", USBHID: 0x0004},
            {name: "KEYCODE_B", USBHID: 0x0005},
            {name: "KEYCODE_C", USBHID: 0x0006},
            {name: "KEYCODE_D", USBHID: 0x0007},
            {name: "KEYCODE_E", USBHID: 0x0008},
            {name: "KEYCODE_F", USBHID: 0x0009},
            {name: "KEYCODE_G", USBHID: 0x000a},
            {name: "KEYCODE_H", USBHID: 0x000b},
            {name: "KEYCODE_I", USBHID: 0x000c},
            {name: "KEYCODE_J", USBHID: 0x000d},
            {name: "KEYCODE_K", USBHID: 0x000e},
            {name: "KEYCODE_L", USBHID: 0x000f},
            {name: "KEYCODE_M", USBHID: 0x0010},
            {name: "KEYCODE_N", USBHID: 0x0011},
            {name: "KEYCODE_O", USBHID: 0x0012},
            {name: "KEYCODE_P", USBHID: 0x0013},
            {name: "KEYCODE_Q", USBHID: 0x0014},
            {name: "KEYCODE_R", USBHID: 0x0015},
            {name: "KEYCODE_S", USBHID: 0x0016},
            {name: "KEYCODE_T", USBHID: 0x0017},
            {name: "KEYCODE_U", USBHID: 0x0018},
            {name: "KEYCODE_V", USBHID: 0x0019},
            {name: "KEYCODE_W", USBHID: 0x001a},
            {name: "KEYCODE_X", USBHID: 0x001b},
            {name: "KEYCODE_Y", USBHID: 0x001c},
            {name: "KEYCODE_Z", USBHID: 0x001d},
            {name: "KEYCODE_1", USBHID: 0x001e},
            {name: "KEYCODE_2", USBHID: 0x001f},
            {name: "KEYCODE_3", USBHID: 0x0020},
            {name: "KEYCODE_4", USBHID: 0x0021},
            {name: "KEYCODE_5", USBHID: 0x0022},
            {name: "KEYCODE_6", USBHID: 0x0023},
            {name: "KEYCODE_7", USBHID: 0x0024},
            {name: "KEYCODE_8", USBHID: 0x0025},
            {name: "KEYCODE_9", USBHID: 0x0026},
            {name: "KEYCODE_0", USBHID: 0x0027},
            {name: "KEYCODE_ENTER", USBHID: 0x0028},
            {name: "KEYCODE_ESCAPE", USBHID: 0x0029},
            {name: "KEYCODE_DEL", USBHID: 0x002a},
            {name: "KEYCODE_TAB", USBHID: 0x002b},
            {name: "KEYCODE_SPACE", USBHID: 0x002c},
            {name: "KEYCODE_MINUS", USBHID: 0x002d},
            {name: "KEYCODE_EQUALS", USBHID: 0x002e},
            {name: "KEYCODE_LEFT_BRACKET", USBHID: 0x002f},
            {name: "KEYCODE_RIGHT_BRACKET", USBHID: 0x0030},
            {name: "KEYCODE_BACKSLASH", USBHID: 0x0031},
            {name: "KEYCODE_SEMICOLON", USBHID: 0x0033},
            {name: "KEYCODE_APOSTROPHE", USBHID: 0x0034},
            {name: "KEYCODE_GRAVE", USBHID: 0x0035},
            {name: "KEYCODE_COMMA", USBHID: 0x0036},
            {name: "KEYCODE_PERIOD", USBHID: 0x0037},
            {name: "KEYCODE_SLASH", USBHID: 0x0038},
            {name: "KEYCODE_CAPS_LOCK", USBHID: 0x0039},
            {name: "KEYCODE_F1", USBHID: 0x003a},
            {name: "KEYCODE_F2", USBHID: 0x003b},
            {name: "KEYCODE_F3", USBHID: 0x003c},
            {name: "KEYCODE_F4", USBHID: 0x003d},
            {name: "KEYCODE_F5", USBHID: 0x003e},
            {name: "KEYCODE_F6", USBHID: 0x003f},
            {name: "KEYCODE_F7", USBHID: 0x0040},
            {name: "KEYCODE_F8", USBHID: 0x0041},
            {name: "KEYCODE_F9", USBHID: 0x0042},
            {name: "KEYCODE_F10", USBHID: 0x0043},
            {name: "KEYCODE_F11", USBHID: 0x0044},
            {name: "KEYCODE_F12", USBHID: 0x0045},
            {name: "KEYCODE_SYSRQ", USBHID: 0x0046},
            {name: "KEYCODE_SCROLL_LOCK", USBHID: 0x0047},
            {name: "KEYCODE_BREAK", USBHID: 0x0048},
            {name: "KEYCODE_INSERT", USBHID: 0x0049},
            {name: "KEYCODE_MOVE_HOME", USBHID: 0x004a},
            {name: "KEYCODE_PAGE_UP", USBHID: 0x004b},
            {name: "KEYCODE_FORWARD_DEL", USBHID: 0x004c},
            {name: "KEYCODE_MOVE_END", USBHID: 0x004d},
            {name: "KEYCODE_PAGE_DOWN", USBHID: 0x004e},
            {name: "KEYCODE_DPAD_RIGHT", USBHID: 0x004f},
            {name: "KEYCODE_DPAD_LEFT", USBHID: 0x0050},
            {name: "KEYCODE_DPAD_DOWN", USBHID: 0x0051},
            {name: "KEYCODE_DPAD_UP", USBHID: 0x0052},
            {name: "KEYCODE_NUM_LOCK", USBHID: 0x0053},
            {name: "KEYCODE_NUMPAD_DIVIDE", USBHID: 0x0054},
            {name: "KEYCODE_NUMPAD_MULTIPLY", USBHID: 0x0055},
            {name: "KEYCODE_NUMPAD_SUBTRACT", USBHID: 0x0056},
            {name: "KEYCODE_NUMPAD_ADD", USBHID: 0x0057},
            {name: "KEYCODE_NUMPAD_ENTER", USBHID: 0x0058},
            {name: "KEYCODE_NUMPAD_1", USBHID: 0x0059},
            {name: "KEYCODE_NUMPAD_2", USBHID: 0x005a},
            {name: "KEYCODE_NUMPAD_3", USBHID: 0x005b},
            {name: "KEYCODE_NUMPAD_4", USBHID: 0x005c},
            {name: "KEYCODE_NUMPAD_5", USBHID: 0x005d},
            {name: "KEYCODE_NUMPAD_6", USBHID: 0x005e},
            {name: "KEYCODE_NUMPAD_7", USBHID: 0x005f},
            {name: "KEYCODE_NUMPAD_8", USBHID: 0x0060},
            {name: "KEYCODE_NUMPAD_9", USBHID: 0x0061},
            {name: "KEYCODE_NUMPAD_0", USBHID: 0x0062},
            {name: "KEYCODE_NUMPAD_DOT", USBHID: 0x0063},
            {name: "KEYCODE_MENU", USBHID: 0x0065},
            {name: "KEYCODE_POWER", USBHID: 0x0066},
            {name: "KEYCODE_NUMPAD_EQUALS", USBHID: 0x0067},
            {name: "KEYCODE_MEDIA_STOP", USBHID: 0x0078},
            {name: "KEYCODE_VOLUME_MUTE", USBHID: 0x007f},
            {name: "KEYCODE_VOLUME_UP", USBHID: 0x0080},
            {name: "KEYCODE_VOLUME_DOWN", USBHID: 0x0081},
            {name: "KEYCODE_NUMPAD_COMMA", USBHID: 0x0085},
            {name: "KEYCODE_NUMPAD_LEFT_PAREN", USBHID: 0x00b6},
            {name: "KEYCODE_NUMPAD_RIGHT_PAREN", USBHID: 0x00b7},
            {name: "KEYCODE_CTRL_LEFT", USBHID: 0x00e0},
            {name: "KEYCODE_SHIFT_LEFT", USBHID: 0x00e1},
            {name: "KEYCODE_ALT_LEFT", USBHID: 0x00e2},
            {name: "KEYCODE_META_LEFT", USBHID: 0x00e3},
            {name: "KEYCODE_CTRL_RIGHT", USBHID: 0x00e4},
            {name: "KEYCODE_SHIFT_RIGHT", USBHID: 0x00e5},
            {name: "KEYCODE_ALT_RIGHT", USBHID: 0x00e6},
            {name: "KEYCODE_META_RIGHT", USBHID: 0x00e7},
            {name: "KEYCODE_MEDIA_PLAY_PAUSE", USBHID: 0x00e8},
            {name: "KEYCODE_MEDIA_PREVIOUS", USBHID: 0x00ea},
            {name: "KEYCODE_MEDIA_NEXT", USBHID: 0x00eb},
            {name: "KEYCODE_MEDIA_EJECT", USBHID: 0x00ec},
            {name: "KEYCODE_EXPLORER", USBHID: 0x00f0},
            {name: "KEYCODE_BACK", USBHID: 0x00f1},
            {name: "KEYCODE_FORWARD", USBHID: 0x00f2},
            {name: "KEYCODE_CALCULATOR", USBHID: 0x00fb},
        ];

        const HIDConsumer = [
            {name: "KEYCODE_POWER", USBHID: 0x0034},
            {name: "KEYCODE_MENU", USBHID: 0x0040},
            {name: "KEYCODE_WINDOW", USBHID: 0x0067},
            {name: "KEYCODE_PROG_RED", USBHID: 0x0069},
            {name: "KEYCODE_PROG_GREEN", USBHID: 0x006a},
            {name: "KEYCODE_PROG_BLUE", USBHID: 0x006b},
            {name: "KEYCODE_PROG_YELLOW", USBHID: 0x006c},
            {name: "KEYCODE_LAST_CHANNEL", USBHID: 0x0083},
            {name: "KEYCODE_TV", USBHID: 0x0089},
            {name: "KEYCODE_EXPLORER", USBHID: 0x008a},
            {name: "KEYCODE_CALL", USBHID: 0x008c},
            {name: "KEYCODE_GUIDE", USBHID: 0x008d},
            {name: "KEYCODE_DVR", USBHID: 0x009a},
            {name: "KEYCODE_CAPTIONS", USBHID: 0x0061},
            {name: "KEYCODE_CHANNEL_UP", USBHID: 0x009c},
            {name: "KEYCODE_CHANNEL_DOWN", USBHID: 0x009d},
            {name: "KEYCODE_MEDIA_PLAY", USBHID: 0x00b0},
            {name: "KEYCODE_BREAK", USBHID: 0x00b1},
            {name: "KEYCODE_MEDIA_RECORD", USBHID: 0x00b2},
            {name: "KEYCODE_MEDIA_FAST_FORWARD", USBHID: 0x00b3},
            {name: "KEYCODE_MEDIA_REWIND", USBHID: 0x00b4},
            {name: "KEYCODE_MEDIA_NEXT", USBHID: 0x00b5},
            {name: "KEYCODE_MEDIA_PREVIOUS", USBHID: 0x00b6},
            {name: "KEYCODE_MEDIA_STOP", USBHID: 0x00b7},
            {name: "KEYCODE_MEDIA_EJECT", USBHID: 0x00b8},
            {name: "KEYCODE_MEDIA_PLAY_PAUSE", USBHID: 0x00cd},
            {name: "KEYCODE_VOLUME_MUTE", USBHID: 0x00e2},
            {name: "KEYCODE_VOLUME_UP", USBHID: 0x00e9},
            {name: "KEYCODE_VOLUME_DOWN", USBHID: 0x00ea},
            {name: "KEYCODE_MEDIA_AUDIO_TRACK", USBHID: 0x0173},
            {name: "KEYCODE_BOOKMARK", USBHID: 0x0182},
            {name: "KEYCODE_MUSIC", USBHID: 0x0183},
            {name: "KEYCODE_ENVELOPE", USBHID: 0x018a},
            {name: "KEYCODE_CONTACTS", USBHID: 0x018d},
            {name: "KEYCODE_CALENDAR", USBHID: 0x018e},
            {name: "KEYCODE_CALCULATOR", USBHID: 0x0192},
            {name: "KEYCODE_EXPLORER", USBHID: 0x0196},
            {name: "KEYCODE_POWER", USBHID: 0x019e},
            {name: "KEYCODE_HEADSETHOOK", USBHID: 0x01b6},
            {name: "KEYCODE_MUSIC", USBHID: 0x01b7},
            {name: "KEYCODE_SEARCH", USBHID: 0x0221},
            {name: "KEYCODE_HOME", USBHID: 0x0223},
            {name: "KEYCODE_BACK", USBHID: 0x0224},
            {name: "KEYCODE_FORWARD", USBHID: 0x0225},
            {name: "KEYCODE_MEDIA_STOP", USBHID: 0x0226},
            {name: "KEYCODE_BOOKMARK", USBHID: 0x022a},
            {name: "KEYCODE_PAGE_UP", USBHID: 0x0233},
            {name: "KEYCODE_PAGE_DOWN", USBHID: 0x0234},
        ];

        const HIDAppLauncher = [
            {name: "AL Launch Button Config. Tool", USBHID: 0x0181},
            {name: "AL Programmable Button Config.", USBHID: 0x0182},
            {name: "AL Consumer Control Config.", USBHID: 0x0183},
            {name: "AL Word Processor", USBHID: 0x0184},
            {name: "AL Text Editor", USBHID: 0x0185},
            {name: "AL Spreadsheet", USBHID: 0x0186},
            {name: "AL Graphics Editor", USBHID: 0x0187},
            {name: "AL Presentation App", USBHID: 0x0188},
            {name: "AL Database App", USBHID: 0x0189},
            {name: "AL Email Reader", USBHID: 0x018a},
            {name: "AL Newsreader", USBHID: 0x018b},
            {name: "AL Voicemail", USBHID: 0x018c},
            {name: "AL Contacts / Address Book", USBHID: 0x018d},
            {name: "AL Calendar / Schedule", USBHID: 0x018e},
            {name: "AL Task / Project Manager", USBHID: 0x018f},
            {name: "AL Log / Journal / Timecard", USBHID: 0x0190},
            {name: "AL Checkbook / Finance", USBHID: 0x0191},
            {name: "AL Calculator", USBHID: 0x0192},
            {name: "AL A/V Capture / Playback", USBHID: 0x0193},
            {name: "AL Local Machine Browser", USBHID: 0x0194},
            {name: "AL LAN/WAN Browser", USBHID: 0x0195},
            {name: "AL Internet Browser", USBHID: 0x0196},
            {name: "AL Remote Networking/ISP Connect", USBHID: 0x0197},
            {name: "AL Network Conference", USBHID: 0x0198},
            {name: "AL Network Chat", USBHID: 0x0199},
            {name: "AL Telephony / Dialer", USBHID: 0x019a},
            {name: "AL Logon", USBHID: 0x019b},
            {name: "AL Logoff", USBHID: 0x019c},
            {name: "AL Logon / Logoff", USBHID: 0x019d},
            {name: "AL Terminal Lock / Screensaver", USBHID: 0x019e},
            {name: "AL Control Panel", USBHID: 0x019f},
            {name: "AL Command Line Processor / Run", USBHID: 0x01a0},
            {name: "AL Process / Task Manager", USBHID: 0x01a1},
            {name: "AL Select Task / Application", USBHID: 0x01a2},
            {name: "AL Next Task / Application", USBHID: 0x01a3},
            {name: "AL Previous Task / Application", USBHID: 0x01a4},
            {name: "AL Preemptive Halt Task / App.", USBHID: 0x01a5},
            {name: "AL Integrated Help Center", USBHID: 0x01a6},
            {name: "AL Documents", USBHID: 0x01a7},
            {name: "AL Thesaurus", USBHID: 0x01a8},
            {name: "AL Dictionary", USBHID: 0x01a9},
            {name: "AL Desktop", USBHID: 0x01aa},
            {name: "AL Spell Check", USBHID: 0x01ab},
            {name: "AL Grammar Check", USBHID: 0x01ac},
            {name: "AL Wireless Status", USBHID: 0x01ad},
            {name: "AL Keyboard Layout", USBHID: 0x01ae},
            {name: "AL Virus Protection", USBHID: 0x01af},
            {name: "AL Encryption", USBHID: 0x01b0},
            {name: "AL Screen Saver", USBHID: 0x01b1},
            {name: "AL Alarms", USBHID: 0x01b2},
            {name: "AL Clock", USBHID: 0x01b3},
            {name: "AL File Browser", USBHID: 0x01b4},
            {name: "AL Power Status", USBHID: 0x01b5},
            {name: "AL Image Browser", USBHID: 0x01b6},
            {name: "AL Audio Browser", USBHID: 0x01b7},
            {name: "AL Movie Browser", USBHID: 0x01b8},
            {name: "AL Digital Rights Manager", USBHID: 0x01b9},
            {name: "AL Digital Wallet", USBHID: 0x01ba},
            {name: "AL Instant Messaging", USBHID: 0x01bc},
            {name: "AL OEM Features / Tips Browser", USBHID: 0x01bd},
            {name: "AL OEM Help", USBHID: 0x01be},
            {name: "AL Online Community", USBHID: 0x01bf},
            {name: "AL Entertainment Content Browser", USBHID: 0x01c0},
            {name: "AL Online Shopping Browser", USBHID: 0x01c1},
            {name: "AL SmartCard Information / Help", USBHID: 0x01c2},
            {name: "AL Market / Finance Browser", USBHID: 0x01c3},
            {name: "AL Customized Corp. News Browser", USBHID: 0x01c4},
            {name: "AL Online Activity Browser", USBHID: 0x01c5},
            {name: "AL Research / Search Browser", USBHID: 0x01c6},
            {name: "AL Audio Player", USBHID: 0x01c7},
        ];

        const HIDAppControl = [
            {name: "AC New", USBHID: 0x0201},
            {name: "AC Open", USBHID: 0x0202},
            {name: "AC Close", USBHID: 0x0203},
            {name: "AC Exit", USBHID: 0x0204},
            {name: "AC Maximize", USBHID: 0x0205},
            {name: "AC Minimize", USBHID: 0x0206},
            {name: "AC Save", USBHID: 0x0207},
            {name: "AC Print", USBHID: 0x0208},
            {name: "AC Properties", USBHID: 0x0209},
            {name: "AC Undo", USBHID: 0x021a},
            {name: "AC Copy", USBHID: 0x021b},
            {name: "AC Cut", USBHID: 0x021c},
            {name: "AC Paste", USBHID: 0x021d},
            {name: "AC Select All", USBHID: 0x021e},
            {name: "AC Find", USBHID: 0x021f},
            {name: "AC Find and Replace", USBHID: 0x0220},
            {name: "AC Search", USBHID: 0x0221},
            {name: "AC Go To", USBHID: 0x0222},
            {name: "AC Home", USBHID: 0x0223},
            {name: "AC Back", USBHID: 0x0224},
            {name: "AC Forward", USBHID: 0x0225},
            {name: "AC Stop", USBHID: 0x0226},
            {name: "AC Refresh", USBHID: 0x0227},
            {name: "AC Previous Link", USBHID: 0x0228},
            {name: "AC Next Link", USBHID: 0x0229},
            {name: "AC Bookmarks", USBHID: 0x022a},
            {name: "AC History", USBHID: 0x022b},
            {name: "AC Subscriptions", USBHID: 0x022c},
            {name: "AC Zoom In", USBHID: 0x022d},
            {name: "AC Zoom Out", USBHID: 0x022e},
            {name: "AC Zoom", USBHID: 0x022f},
            {name: "AC Full Screen View", USBHID: 0x0230},
            {name: "AC Normal View", USBHID: 0x0231},
            {name: "AC View Toggle", USBHID: 0x0232},
            {name: "AC Scroll Up", USBHID: 0x0233},
            {name: "AC Scroll Down", USBHID: 0x0234},
            {name: "AC Pan Left", USBHID: 0x0236},
            {name: "AC Pan Right", USBHID: 0x0237},
            {name: "AC New Window", USBHID: 0x0239},
            {name: "AC Tile Horizontally", USBHID: 0x023a},
            {name: "AC Tile Vertically", USBHID: 0x023b},
            {name: "AC Format", USBHID: 0x023c},
            {name: "AC Edit", USBHID: 0x023d},
            {name: "AC Bold", USBHID: 0x023e},
            {name: "AC Italics", USBHID: 0x023f},
            {name: "AC Underline", USBHID: 0x0240},
            {name: "AC Strikethrough", USBHID: 0x0241},
            {name: "AC Subscript", USBHID: 0x0242},
            {name: "AC Superscript", USBHID: 0x0243},
            {name: "AC All Caps", USBHID: 0x0244},
            {name: "AC Rotate", USBHID: 0x0245},
            {name: "AC Resize", USBHID: 0x0246},
            {name: "AC Flip horizontal", USBHID: 0x0247},
            {name: "AC Flip Vertical", USBHID: 0x0248},
            {name: "AC Mirror Horizontal", USBHID: 0x0249},
            {name: "AC Mirror Vertical", USBHID: 0x024a},
            {name: "AC Font Select", USBHID: 0x024b},
            {name: "AC Font Color", USBHID: 0x024c},
            {name: "AC Font Size", USBHID: 0x024d},
            {name: "AC Justify Left", USBHID: 0x024e},
            {name: "AC Justify Center H", USBHID: 0x024f},
            {name: "AC Justify Right", USBHID: 0x0250},
            {name: "AC Justify Block H", USBHID: 0x0251},
            {name: "AC Justify Top", USBHID: 0x0252},
            {name: "AC Justify Center V", USBHID: 0x0253},
            {name: "AC Justify Bottom", USBHID: 0x0254},
            {name: "AC Justify Block V", USBHID: 0x0255},
            {name: "AC Indent Decrease", USBHID: 0x0256},
            {name: "AC Indent Increase", USBHID: 0x0257},
            {name: "AC Numbered List", USBHID: 0x0258},
            {name: "AC Restart Numbering", USBHID: 0x0259},
            {name: "AC Bulleted List", USBHID: 0x025a},
            {name: "AC Promote", USBHID: 0x025b},
            {name: "AC Demote", USBHID: 0x025c},
            {name: "AC Yes", USBHID: 0x025d},
            {name: "AC No", USBHID: 0x025e},
            {name: "AC Cancel", USBHID: 0x025f},
            {name: "AC Catalog", USBHID: 0x0260},
            {name: "AC Buy / Checkout", USBHID: 0x0261},
            {name: "AC Add to Cart", USBHID: 0x0262},
            {name: "AC Expand", USBHID: 0x0263},
            {name: "AC Expand All", USBHID: 0x0264},
            {name: "AC Collapse", USBHID: 0x0265},
            {name: "AC Collapse All", USBHID: 0x0266},
            {name: "AC Print Preview", USBHID: 0x0267},
            {name: "AC Paste Special", USBHID: 0x0268},
            {name: "AC Insert Mode", USBHID: 0x0269},
            {name: "AC Delete", USBHID: 0x026a},
            {name: "AC Lock", USBHID: 0x026b},
            {name: "AC Unlock", USBHID: 0x026c},
            {name: "AC Protect", USBHID: 0x026d},
            {name: "AC Unprotect", USBHID: 0x026e},
            {name: "AC Attach Comment", USBHID: 0x026f},
            {name: "AC Delete Comment", USBHID: 0x0270},
            {name: "AC View Comment", USBHID: 0x0271},
            {name: "AC Select Word", USBHID: 0x0272},
            {name: "AC Select Sentence", USBHID: 0x0273},
            {name: "AC Select Paragraph", USBHID: 0x0274},
            {name: "AC Select Column", USBHID: 0x0275},
            {name: "AC Select Row", USBHID: 0x0276},
            {name: "AC Select Table", USBHID: 0x0277},
            {name: "AC Select Object", USBHID: 0x0278},
            {name: "AC Redo / Repeat", USBHID: 0x0279},
            {name: "AC Sort", USBHID: 0x027a},
            {name: "AC Sort Ascending", USBHID: 0x027b},
            {name: "AC Sort Descending", USBHID: 0x027c},
            {name: "AC Filter", USBHID: 0x027d},
            {name: "AC Set Clock", USBHID: 0x027e},
            {name: "AC View Clock", USBHID: 0x027f},
            {name: "AC Select Time Zone", USBHID: 0x0280},
            {name: "AC Edit Time Zones", USBHID: 0x0281},
            {name: "AC Set Alarm", USBHID: 0x0282},
            {name: "AC Clear Alarm", USBHID: 0x0283},
            {name: "AC Snooze Alarm", USBHID: 0x0284},
            {name: "AC Reset Alarm", USBHID: 0x0285},
            {name: "AC Synchronize", USBHID: 0x0286},
            {name: "AC Send/Receive", USBHID: 0x0287},
            {name: "AC Send To", USBHID: 0x0288},
            {name: "AC Reply", USBHID: 0x0289},
            {name: "AC Reply All", USBHID: 0x028a},
            {name: "AC Forward Msg", USBHID: 0x028b},
            {name: "AC Send", USBHID: 0x028c},
            {name: "AC Attach File", USBHID: 0x028d},
            {name: "AC Upload", USBHID: 0x028e},
            {name: "AC Download (Save Target As)", USBHID: 0x028f},
            {name: "AC Set Borders", USBHID: 0x0290},
            {name: "AC Insert Row", USBHID: 0x0291},
            {name: "AC Insert Column", USBHID: 0x0292},
            {name: "AC Insert File", USBHID: 0x0293},
            {name: "AC Insert Picture", USBHID: 0x0294},
            {name: "AC Insert Object", USBHID: 0x0295},
            {name: "AC Insert Symbol", USBHID: 0x0296},
            {name: "AC Save and Close", USBHID: 0x0297},
            {name: "AC Rename", USBHID: 0x0298},
            {name: "AC Merge", USBHID: 0x0299},
            {name: "AC Split", USBHID: 0x029a},
            {name: "AC Distribute Horizontally", USBHID: 0x029b},
            {name: "AC Distribute Vertically", USBHID: 0x029c},
        ];

        const KeyEventCodeMap = {
            "Enter":"KEYCODE_ENTER",
            "ArrowDown":"KEYCODE_DPAD_DOWN",
            "ArrowLeft":"KEYCODE_DPAD_LEFT",
            "ArrowRight":"KEYCODE_DPAD_RIGHT",
            "ArrowUp":"KEYCODE_DPAD_UP",
            "End":"KEYCODE_MOVE_END",
            "Home":"KEYCODE_MOVE_HOME",
            "PageDown":"KEYCODE_PAGE_DOWN",
            "PageUp":"KEYCODE_PAGE_UP",
            "Backspace":"KEYCODE_DEL",
            "IntlBackslash":"KEYCODE_INTL_BACKSLASH", /* 0x0032 */
            "Comma":"KEYCODE_COMMA",                  /* 0x0036 */
            "Period":"KEYCODE_PERIOD",                /* 0x0037 */
            "Slash":"KEYCODE_SLASH",                  /* 0x0038 */
            "Semicolon":"KEYCODE_SEMICOLON",          /* 0x0033 */
            "Quote":"KEYCODE_APOSTROPHE",             /* 0x0034 */
            "Backslash":"KEYCODE_BACKSLASH",          /* 0x0032 */
            "BracketLeft":"KEYCODE_LEFT_BRACKET",     /* 0x002f */
            "BracketRight":"KEYCODE_RIGHT_BRACKET",   /* 0x0030 */
            "Minus":"KEYCODE_MINUS",                  /* 0x002d */
            "Equal":"KEYCODE_EQUALS",                 /* 0x002e */
            "Backquote":"KEYCODE_GRAVE",              /* 0x0035 */
            "Tab":"KEYCODE_TAB",                      /* 0x002b */
        };

        const InternalUsage = [
            {name: "TOGGLE_MOUSE", USBHID: 0x0001},
        ];

        const TYPE_KEYBOARD = 1;
        const TYPE_CONSUMER = 2;
        const TYPE_APP_LAUNCHER = 3;
        const TYPE_APP_CONTROL = 4;
        const TYPE_INTERNAL_USAGE = 5;

        const KB_QWERTZ = 0;
        const KB_QWERTY = 1;

        const USBHIDType = {
            keyboard: {typeId: TYPE_KEYBOARD, buttons: HIDKeyboard, label: "Keyboard 0x07", typeName: "KEYBOARD"},
            internalUsage: {typeId: TYPE_INTERNAL_USAGE, buttons: InternalUsage, label: "Internal Usage", typeName: "INTERNAL"},
            consumer: {typeId: TYPE_CONSUMER, buttons: HIDConsumer, label: "Consumer 0x0c", typeName: "CONSUMER"},
            appLauncher: {typeId: TYPE_APP_LAUNCHER, buttons: HIDAppLauncher, label: "Consumer 0x0c (App Launcher)", typeName: "APP_LAUNCHER"},
            appControl: {typeId: TYPE_APP_CONTROL, buttons: HIDAppControl, label: "Consumer 0x0c (App Control)", typeName: "APP_CONTROL"} 
        };

        Object.defineProperty(AllButtons.prototype, 'buttons', {
            get() { return USBHIDType; }
        });

        pageController = (new PageController()).run();
    </script>
</body>
</html>